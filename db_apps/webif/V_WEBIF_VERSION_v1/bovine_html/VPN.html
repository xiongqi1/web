<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<%if( request["SESSION_ID"]!=session["sessionid"] ) { redirect('/index.html'); exit(403); } %>
<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>VPN</title>
<script language="JavaScript" src="/stdlibjs.htm"></script>
<script language="JavaScript" src="/cgi-bin/vpn.cgi"></script>
<link href="/BovineStyle.css" rel="stylesheet" type="text/css" />

<style>
.bar_bg {
	left:47px;
	width:200px;
	height:10px; 
	font-size: 12px;	

	background-color:lightgrey; 
	
	border-top:1px solid white;
	border-bottom:1px solid white;
	border-left:1px solid white;
	border-right:1px solid white;
	
}

.bar_fg {
	height:10px; 
	width:50%;
	font-size: 12px;	
	
	background-color:blue; 
	align:center
}

</style>

</head>
<body onload="bodyOnLoad();">
<div id="contentWrapper">
<% include menu.html %>

<script language="JavaScript">
var client_certificate;
var installed_certificate;
var server_certificate;
var server_secret_time="";
var client_secret_time="";

var default_vpnport="1194";
var default_vpnporttype="UDP";
var default_vpnnwaddr="10.0.0.0";
var default_vpnnwmask="255.255.255.0";

var IPSRsaLocalCertValid="";
var IPSRsaRemoteCertValid="";
var IPSRsaKeyValid="";
var curDate;
var curTime;
var actTunnelNum=0;
var ipsecTunnelMap=new Array();

function exitHandler() {
	if(document.form.curindex.value >= 0)
		window.location="/VPN.html"
	else
		showedit( 'edit', false, st.length );
}

function hasSubStr(str, substr) {
	return str.search(substr) >= 0;
}

function checkPptpForm() {
	var f=document.form;
	if( f.profileType.value == "pptp.0" )
	{
		if (f.username.value == "") {
			alert("Error: No user name entered");
			return false;
		}
		if (f.pass.value == "") {
			alert("Error: No password entered");
			return false;
		}
		if ( (f.metric.value < 0 ) || (f.metric.value > 65535) )
		{
			alert("Error: Metric must have a value between 0 and 65535");
			f.metric.select();
			return false;
		}
	}
	if (f.vpnserver.value == "" ) {
		alert("Error: No server IP address entered or not entered correctly");
		return false;
	}
	if ( (f.reconnectDelay.value < 30 ) || (f.reconnectDelay.value > 65535) ) {
		alert("Error: Reconnect Delay must have a value between 30 and 65535");
		f.reconnectDelay.select();
		return false;
	}
	if ( (f.reconnectRetries.value < 0 ) || (f.reconnectRetries.value > 65535) ) {
		alert("Error: Reconnect Retries must have a value between 0 and 65535");
		f.reconnectRetries.select();
		return false;
	}
	return true;
}

function checkGreForm() {
	var f=document.form;

	if(!checkPptpForm())
		return false;

	if ( (f.ttl.value < 0 ) || (f.ttl.value > 255) ) {
		alert("Error: TTL must have a value between 0 and 255");
		f.ttl.select();
		return false;
	}
	return true;
}

function isValidIpAddress(str) {
	regaddr=/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/
	return regaddr.exec(str)!=null;
}

function checkOpenVpnForm() {
	vpnType=readElement("vpnType");
	
	if( vpnType=="server" ) {
		if( (readElement("vpnServerServerPort").length==0) || (readElement("vpnServerNwAddr").length==0) || (readElement("vpnNwMask").length==0) ) {
			alert("Please ensure you enter server port, network address and network mask");
			return false;
		}

		if(readElement("vpnServerAuthTypeValue")==1) {
			if( (readElement("vpnServerAuthUser").length==0) || (readElement("vpnServerAuthPass").length==0) ) {
				alert("Please ensure you enter user name and password");
				return false;
			}
		}
	}
	else if (vpnType=="client") {
		if( (readElement("vpnClientServerAddr").length==0) || (readElement("vpnClientServerPort").length==0)) {
			alert("Please ensure you enter server IP address and port");
			return false;
		}

		if(readElement("vpnClientAuthTypeValue")==1) {
			if( (readElement("vpnClientAuthUser").length==0) || (readElement("vpnClientAuthPass").length==0) ) {
				alert("Please ensure you enter user name and password");
				return false;
			}
		}

		if(readElement("vpnClientCertiSel2").length==0) {
			alert("Please ensure you select certificate");
			return false;
		}
	}
	else if (vpnType=="peer") {
		if( (readElement("vpnPeerServerPort").length==0) || (readElement("vpnLocalAddr").length==0) || (readElement("vpnRemoteAddr").length==0) ) {
				alert("Please ensure you enter server port and local IP address");
				return false;
		}

		var nwaddr=readElement("vpnCertiPeerNwAddr");
		var nwmask=readElement("vpnCertiPeerNwMask");
		
		if(nwaddr.length>0 || nwmask.length>0) {
			if(!isValidIpAddress(nwaddr)) {
				alert("Please ensure you enter correct network address");
				return;
			}
		
			if(!isValidIpAddress(nwmask)) {
				alert("Please ensure you enter correct network mask");
				return;
			}
		}

		if( readElement("vpnPeerServerAddr").length==0) {
			if(server_secret_time=="") {
				alert("Please ensure you generate server secret key");
				return false;
			}
		}
		else {
			if(client_secret_time=="") {
				alert("Please ensure you upload client secret key");
				return false;
			}
		}
		
	}
	return true;
}

function checkIpsecForm() {
	var f = document.form;
	var keyMode = f.IpSecMethod.value;
	if (keyMode == "")
		keyMode = "none";
	if ((keyMode != "none") && 
		((f.IPSRemGateway.value  == "") ||
		(f.IPSRemLan1.value  == "") ||
		(f.IPSRemLan2.value  == "") ||
		(f.IPSRemLan3.value  == "") ||
		(f.IPSRemLan4.value == "") ||
		(f.IPSRemMask1.value  == "") ||
		(f.IPSRemMask2.value  == "") ||
		(f.IPSRemMask3.value  == "") ||
		(f.IPSRemMask4.value == "") ||
		(f.IPSLocLan1.value  == "") ||
		(f.IPSLocLan2.value  == "") ||
		(f.IPSLocLan3.value  == "") ||
		(f.IPSLocLan4.value == "") ||
		(f.IPSLocMask1.value  == "") ||
		(f.IPSLocMask2.value  == "") ||
		(f.IPSLocMask3.value  == "") ||
		(f.IPSLocMask4.value == ""))) {
		alert("All IP address and mask values for local and gateway must be filled in.");
		return;
	}
	if (keyMode == "psk") {
		if (f.PskValue.value == "") {
			alert("Key Mode PSK requires a PSK Password.");
			return false;
		}
	}else if(keyMode == "rsa") {
		 //nothing to check
	}
	else if (keyMode == "cert") {
		if (f.KeyPassword.value == "") {
			alert("Your secret private key should be protected by a password.");
			return false;
		}
		//if (f.IPSRsaKeyValid.value != "ok" ||
		//	f.IPSRsaLocalCertValid.value != "ok" ||
		//	f.IPSRsaRemoteCertValid.value != "ok") {
		//	alert("You need to upload your private key, your certificate, and the gateway certificate.");
		//	return false;
		//}
	}
	if(isNaN(parseInt(f.IpsecLifeTime.value)) == true){
		alert("You need to input a valid lifetime number.");
		return false;
	}
	if(isNaN(parseInt(f.IpsecIkeTime.value)) == true){
		alert("You need to input a valid iketime number.");
		return false;
	}
	if(isNaN(parseInt(f.DpdTimeout.value)) == true){
		alert("You need to input a valid dpd timeout number.");
		return false;
	}
	if(isNaN(parseInt(f.DpdTimeDelay.value)) == true){
		alert("You need to input a valid dpd keep alive time.");
		return false;
	}
	return true;
}
function submitPptpForm() {
	var f=document.form;
	var header = "&link.profile."+i+".";

	f.rdbCmd.value = "link.profile."+i+".dev="+f.profileType.value+header+"name="+f.newname.value+header+"user="+f.username.value+header+"pass="+f.pass.value+header+"enable="+f.vpnenable.value+header+"defaultroutemetric="+f.metric.value+header+"default.dnstopptp="+f.dnstopptp.value+header+"serveraddress="+f.vpnserver.value+header+"snat="+f.snatEnable.value+header+"default.defaultroutemetric="+f.sdefGwEnable.value+header+"reconnect_delay="+f.reconnectDelay.value+header+"reconnect_retries="+f.reconnectRetries.value+header+"authtype="+f.authType.value+header+"verbose_logging="+f.pppDebug.value;
	f.submit();
}

function submitGreForm() {
	var f=document.form;
	var header = "&link.profile."+i+".";

	f.rdbCmd.value = "link.profile."+i+".dev="+f.profileType.value+header+"name="+f.newname.value+header+"enable="+f.vpnenable.value+header+"serveraddress="+f.vpnserver.value+header+"reconnect_delay="+f.reconnectDelay.value+header+"reconnect_retries="+f.reconnectRetries.value+header+"ttl="+f.ttl.value+header+"verbose_logging="+f.pppDebug.value;
	f.submit();
}

function submitOpenVpn() {
	var f=document.form;
	var header = "&link.profile."+i+".";

	authType="";
	authUser="";
	authPass="";
	serverAdd="";
	serverPort="";
	serverPortType="UDP";
	clientDefGw="0";

	if(f.vpnType.value=="server") {
		serverAddr=""
		serverPort=f.vpnServerServerPort.value;
		serverPortType=f.vpnServerServerPortType.value;
		authType=f.vpnServerAuthTypeValue.value;
		authUser=f.vpnServerAuthUser.value;
		authPass=f.vpnServerAuthPass.value;
		clientDefGw="0";
	}
	else if(f.vpnType.value=="client") {
		serverAddr=f.vpnClientServerAddr.value;
		serverPort=f.vpnClientServerPort.value;
		serverPortType=f.vpnClientServerPortType.value;
		authType=f.vpnClientAuthTypeValue.value;
		authUser=f.vpnClientAuthUser.value;
		authPass=f.vpnClientAuthPass.value;
		if(f.vpnClientServerGateway.checked)
			clientDefGw="1";
		else
			clientDefGw="0";
	}
	else if(f.vpnType.value=="peer") {
		serverAddr=f.vpnPeerServerAddr.value;
		serverPort=f.vpnPeerServerPort.value;
		serverPortType=f.vpnPeerServerPortType.value;
	}
	else {
		alert("Error: Unknown VPN mode found #1");
	}

	f.rdbCmd.value = "link.profile."+i+".dev="+f.profileType.value
		+header+"name="+f.newname.value
		+header+"enable="+f.vpnenable.value
		+header+"vpn_type="+f.vpnType.value
		+header+"network_addr="+f.vpnServerNwAddr.value
		+header+"network_mask="+f.vpnNwMask.value
		+header+"vpn_authtype="+authType
		+header+"user="+authUser
		+header+"pass="+authPass
		+header+"serveraddress="+serverAddr
		+header+"serverport="+serverPort
		+header+"serverporttype="+serverPortType
		+header+"local_ipaddr="+f.vpnLocalAddr.value
		+header+"remote_ipaddr="+f.vpnRemoteAddr.value
		+header+"remote_nwaddr="+f.vpnCertiPeerNwAddr.value
		+header+"remote_nwmask="+f.vpnCertiPeerNwMask.value
		+header+"certi="+f.vpnClientCertiSel2.value
		+header+"defaultgw="+clientDefGw;
	f.submit();
}

function submitIpsecForm() {
	var f=document.form;
	var header = "&link.profile."+i+".";
	var keyMode = f.IpSecMethod.value;	

	f.IpSecMethod.value = keyMode;

	f.RemGateway.value = f.IPSRemGateway.value;
	f.RemLan.value = f.IPSRemLan1.value + "."  + f.IPSRemLan2.value + "." + f.IPSRemLan3.value + "." + f.IPSRemLan4.value;
	f.RemLan_2.value = f.IPSRemLan_21.value + "."  + f.IPSRemLan_22.value + "." + f.IPSRemLan_23.value + "." + f.IPSRemLan_24.value;
	f.RemLan_3.value = f.IPSRemLan_31.value + "."  + f.IPSRemLan_32.value + "." + f.IPSRemLan_33.value + "." + f.IPSRemLan_34.value;
	f.RemLan_4.value = f.IPSRemLan_41.value + "."  + f.IPSRemLan_42.value + "." + f.IPSRemLan_43.value + "." + f.IPSRemLan_44.value;

	f.RemMask.value = f.IPSRemMask1.value + "."  + f.IPSRemMask2.value + "." + f.IPSRemMask3.value + "." + f.IPSRemMask4.value;
	f.LocLan.value = f.IPSLocLan1.value + "."  + f.IPSLocLan2.value + "." + f.IPSLocLan3.value + "." + f.IPSLocLan4.value;
	f.LocMask.value = f.IPSLocMask1.value + "."  + f.IPSLocMask2.value + "." + f.IPSLocMask3.value + "." + f.IPSLocMask4.value;

	f.rdbCmd.value = "link.profile."+i+".dev="+f.profileType.value
		+header+"name="+f.newname.value
		+header+"enable="+f.vpnenable.value
		+header+"remote_gateway="+f.RemGateway.value
		+header+"remote_lan="+f.RemLan.value
		+header+"remote_lan2="+f.RemLan_2.value
		+header+"remote_lan3="+f.RemLan_3.value
		+header+"remote_lan4="+f.RemLan_4.value

		+header+"remote_mask="+f.RemMask.value
		+header+"local_lan="+f.LocLan.value
		+header+"local_mask="+f.LocMask.value
		+header+"enccap_protocol="+f.ipsecEncap.value
		+header+"ike_mode="+f.ipsecIKEMode.value
		+header+"pfs="+f.ipsecPfs.value
		+header+"ike_enc="+f.ipsecIKEEnc.value
		+header+"ike_hash="+f.ipsecIKEHash.value
		+header+"ipsec_enc="+f.ipsecEnc.value
		+header+"ipsec_hash="+f.ipsecHash.value
		+header+"ipsec_dhg="+f.ipsecDHG.value
		+header+"ipsec_method="+f.IpSecMethod.value
		+header+"ipsec_dpd="+f.ipsecDpdaction.value
		+header+"psk_value="+f.PskValue.value
		+header+"psk_remoteid="+f.PskRemoteId.value
		+header+"psk_localid="+f.PskLocalId.value
		+header+"rsa_remoteid="+f.RsaRemoteId.value
		+header+"rsa_localid="+f.RsaLocalId.value
		+header+"key_password="+f.KeyPassword.value
		+header+"life_time="+f.IpsecLifeTime.value
		+header+"dpd_time="+f.DpdTimeDelay.value
		+header+"dpd_timeout="+f.DpdTimeout.value
		+header+"ike_time="+f.IpsecIkeTime.value
		+"&ipsec.0.profile="+i
	f.submit();
}

function submitForm() {       
	var f=document.form;
	try {
		document.form.rdbCmd.value = "";
		if (f.vpnEnable[0].checked == true) {
			if(f.profileType.value == "pptp.0") {
				if(!checkPptpForm())
					return;
			}
			else if (f.profileType.value == "gre.0") {
				if(!checkGreForm())
					return;
			}
			else if (f.profileType.value == "openvpn.0") {
				if(!checkOpenVpnForm())
					return;
			}else if(f.profileType.value == "ipsec.0") {
				if(!checkIpsecForm())
					return;
			}else {
				alert("Error: Unknown VPN mode found #2");
			}
		}

		value = parseInt(f.editindex.value);  
		if( st.length==0 || isNaN(value)==true || value < 0 || value >= st.length ) {
			i = newprofilenum; //add new	
		}
		else if( isNaN(st[value].profilenum)==true ) {
			alert("Error: Profile number incorrectly");	
			return;
		}
		else {
			i=st[value].profilenum;
		}
		ungreyOutVPNfields(0);

		if(f.profileType.value == "pptp.0") {
			submitPptpForm();
		}
		else if (f.profileType.value == "gre.0") {
			submitGreForm();
		}
		else if (f.profileType.value == "openvpn.0") {
			submitOpenVpn();
		}
		else if(f.profileType.value == "ipsec.0") {
			submitIpsecForm();
		}
		else {
			alert("Error: Unknown VPN mode found #3");
		}
	}
	catch(e) {
		alert(e.message);
	}
} 

function delentry( index ) {
	try {
		i=st[index].profilenum;
		document.form.rdbCmd.value = "link.profile."+i+".name=&link.profile."+i+".enable=0";
		document.form.submit();
	}
	catch(e) {
		alert(e.message);
	}
}

function greyOutVPNfields() {
	try { // if PPTP is disabled then grey out the fields
		document.form.username.disabled = true;	
		document.form.pass.disabled = true;
		document.form.vpnserver.disabled = true;
		document.form.pptpDefaultDNSEnable[1].checked = true;
		document.form.newname.disabled = true;	
		document.form.metric.disabled = true;
		document.form.authType.disabled = true;
		document.form.reconnectDelay.disabled = true;
		document.form.reconnectRetries.disabled = true;
		document.form.ttl.disabled = true;
		document.form.pptpDefaultDNSEnable[0].disabled = true;
		document.form.pptpDefaultDNSEnable[1].disabled = true;
		document.form.NatEnable[0].disabled = true;
		document.form.NatEnable[1].disabled = true;
		document.form.DefGwEnable[0].disabled = true;
		document.form.DefGwEnable[1].disabled = true;
		document.form.pppDebug[0].disabled = true;
		document.form.pppDebug[1].disabled = true;
	}
	catch(e) {
	    alert(e.message);
	}
}


function ungreyOutVPNfields(ini) {
	try { // if PPTP is disabled then grey out the fields
		document.form.username.disabled = false;
		document.form.pass.disabled = false;
		document.form.vpnserver.disabled = false;
		document.form.newname.disabled = false;
		document.form.metric.disabled = false;
		document.form.authType.disabled = false;
		document.form.reconnectDelay.disabled = false;
		document.form.reconnectRetries.disabled = false;
		document.form.ttl.disabled = false;
		// also enable the default route
		if (!ini)
		{
			//document.form.pptpDefaultRouteEnable[0].checked = true;
			document.form.pptpDefaultDNSEnable[0].checked = true;
		}
		document.form.pptpDefaultDNSEnable[0].disabled = false;
		document.form.pptpDefaultDNSEnable[1].disabled = false;
		document.form.NatEnable[0].disabled = false;
		document.form.NatEnable[1].disabled = false;
		document.form.DefGwEnable[0].disabled = false;
		document.form.DefGwEnable[1].disabled = false;
		document.form.pppDebug[0].disabled = false;
		document.form.pppDebug[1].disabled = false;
	}
	catch(e) {
		alert(e.message);
	}
}

/*
function checkVPNconf() {
	try {
		if (document.form.vpnEnable[1].checked == true) {
			greyOutVPNfields();
		}
		else if (document.form.vpnEnable[0].checked == true) {
			ungreyOutVPNfields(1);
		}
	}
	catch (e) {
		alert(e.message);
	}
}*/

function setVpnEnable(en) {
	var f=document.form;
	f.vpnEnable[0].checked=(en==1);
	f.vpnEnable[1].checked=(en==0);

	if(en==1)
		ungreyOutVPNfields(0);
	else
		greyOutVPNfields();

	vpnElments=[
		// openvpn common part
		"vpnType",

		// openvpn server
		"vpnServerServerPort",
		"vpnServerServerPortType",
		"vpnServerNwAddr",
		"vpnNwMask",
		"vpnServerAuthTypeValue",
		"vpnServerAuthUser",
		"vpnServerAuthPass",

		"vpnCertiCaNwAddr",
		"vpnCertiCaNwMask",

		// openvpn server - certificate
		"vpnServerCertiSel",

		"vpnCertiName",
		"vpnCertiCountry",
		"vpnCertiState",
		"vpnCertiCity",
		"vpnCertiOrg",
		"vpnCertiEmail",

		"vpnClientServerAddr",
		"vpnClientServerPort",
		"vpnClientServerPortType",

		"vpnClientAuthUser",
		"vpnClientAuthPass",

		"vpnClientCertiSel",

		"vpnCertiName2",
		"vpnCertiCountry2",
		"vpnCertiState2",
		"vpnCertiCity2",
		"vpnCertiOrg2",
		"vpnCertiEmail2",

		"vpnPeerServerAddr",
		"vpnPeerServerPort",
		"vpnPeerServerPortType",

		"vpnLocalAddr",
		"vpnRemoteAddr",

		"vpnCertiPeerNwAddr",
		"vpnCertiPeerNwMask",

		"vpnSecretServerKeyTime",
		"vpnSecretClientKeyTime",

		"vpnClientAuthTypeCerti",
		"vpnClientAuthTypeCerti",
		"vpnServerAuthTypeCerti",
		"vpnServerAuthTypeCerti",

		"vpnServerGenCertiBtn",
		"vpnServerDnCertiBtn",

		"vpnServerGenClientBtn",
		"vpnServerDnClientBtn",
		"vpnServerRmClientBtn",

		"vpnClientUpCerti",
		"vpnClientDelCerti"
	];

	var i;
	for(i=0;i<vpnElments.length;i++) {
		el=document.getElementById(vpnElments[i]);
		if(el!=null)
			el.disabled=(en==0);
	}
}

function arragePptpForm(idx) {
	var f=document.form;

	pppDebug=st[idx].pppdebug;
	if( parseInt(pppDebug)==1 )
		f.pppDebug[0].checked=true;
	else
		f.pppDebug[1].checked=true;
	with ( document.forms[0] ) {
		setSelect(profileType, st[idx].type);
		setSelect(authType, st[idx].authtype);
	}

	if(f.vpnenable.value=='1') {
		ungreyOutVPNfields(0);
		f.vpnEnable[0].checked=true;
	}
	else {
		greyOutVPNfields();
		f.vpnEnable[1].checked=true;
	}

	if(f.dnstopptp.value=='1')   
		f.pptpDefaultDNSEnable[0].checked=true;
	else
		f.pptpDefaultDNSEnable[1].checked=true;

	if( parseInt(f.snatEnable.value)==1 )
		f.NatEnable[0].checked=true;
	else
		f.NatEnable[1].checked=true;

	if( parseInt(f.sdefGwEnable.value)==1 )
		f.DefGwEnable[0].checked=true;
	else
		f.DefGwEnable[1].checked=true;
}

function initPptpForm(idx) {
	var f=document.form;

	f.vpnenable.value=st[idx].enable;
	f.metric.value=st[idx].metric;
	f.dnstopptp.value=st[idx].dnstopptp;
	f.newname.value=st[idx].name;
	f.username.value=st[idx].user;
	f.pass.value=st[idx].pass;
	f.vpnserver.value=st[idx].serveraddress;
	f.reconnectDelay.value = st[idx].reconnect_delay;
	f.reconnectRetries.value = st[idx].reconnect_retries;
	f.ttl.value = st[idx].ttl;
	f.snatEnable.value = st[idx].snat;
	f.sdefGwEnable.value = st[idx].sdefgw;
	arragePptpForm(idx);
}

function initGreForm(idx) {
	initPptpForm(idx)
}

function initEmptyForm(idx) {
	var f=document.form;
	// initial type
	f.profileType.value="pptp.0"
	
	// init pptp & gre variables
	f.vpnenable.value='1';

	f.vpnEnable[0].checked=true;
	f.vpnEnable[1].checked=false;

	f.metric.value='30';
	f.dnstopptp.value='0';
	f.newname.value='';
	f.username.value='';
	f.pass.value='';
	f.vpnserver.value='';
	f.vpnserver.value='';
	f.reconnectDelay.value = "30";
	f.reconnectRetries.value = "0";
	f.ttl.value = '255';
	f.snatEnable.value = '0';
	f.sdefGwEnable.value = '0';
	f.pppDebug[1].checked=true;

	f.pptpDefaultDNSEnable[1].checked=true;
	f.NatEnable[1].checked=true;		
	f.DefGwEnable[1].checked=true;		

	// openvpn common part
	f.vpnType.value="server";
	// openvpn server
	f.vpnServerServerPort.value=default_vpnport;
	f.vpnServerServerPortType.value=default_vpnporttype;
	f.vpnServerNwAddr.value=default_vpnnwaddr;
	f.vpnNwMask.value=default_vpnnwmask;
	f.vpnServerAuthTypeValue.value=0;
	f.vpnServerAuthUser.value="";
	f.vpnServerAuthPass.value="";
	// openvpn server - certificate
	f.vpnServerCertiSel.value=0;
	f.vpnCertiName.value="";
	f.vpnCertiCountry.value="";
	f.vpnCertiState.value="";
	f.vpnCertiCity.value="";
	f.vpnCertiOrg.value="";
	f.vpnCertiEmail.value="";
	f.vpnClientServerAddr.value="";
	f.vpnClientServerPort.value=default_vpnport;
	f.vpnClientServerPortType.value=default_vpnporttype;
	f.vpnClientServerGateway.checked=false;
	f.vpnClientAuthTypeValue.value=0;
	f.vpnClientAuthUser.value="";
	f.vpnClientAuthPass.value="";
	f.vpnClientCertiSel.value="";
	f.vpnCertiName2.value="";
	f.vpnCertiCountry2.value="";
	f.vpnCertiState2.value="";
	f.vpnCertiCity2.value="";
	f.vpnCertiOrg2.value="";
	f.vpnCertiEmail2.value="";
	f.vpnPeerServerAddr.value="";
	f.vpnPeerServerPort.value=default_vpnport;
	f.vpnPeerServerPortType.value=default_vpnporttype;
	f.vpnLocalAddr.value="";
	f.vpnRemoteAddr.value="";
	f.vpnSecretServerKeyTime.value="";
	f.vpnSecretClientKeyTime.value="";
	//ipsec
	f.ipsecEncap.value="esp";
	f.ipsecIKEMode.value="main";
	f.ipsecPfs.value="on";
	f.ipsecIKEEnc.value="any";
	f.ipsecIKEHash.value="any";
	f.ipsecEnc.value="any";
	f.ipsecHash.value="any";
	f.ipsecDpdaction.value="hold";
	f.ipsecDHG.value="any";
	f.IpSecMethod.value="psk";
	f.PskValue.value ="";
	f.PskRemoteId.value ="";
	f.PskLocalId.value ="";
	f.RsaRemoteId.value ="";
	f.RsaLocalId.value ="";
	f.KeyPassword.value ="";
	f.RemGateway.value="";
	f.RemLan.value="";
	f.RemMask.value="";
	f.LocLan.value="";
	f.LocMask.value="";
	f.IpsecLifeTime.value="28800";
	f.IpsecIkeTime.value="3600";
	f.DpdTimeDelay.value="10";
	f.DpdTimeout.value="60";
	f.IPSRemGateway.value = "";
	f.IPSRemLan1.value ="";
	f.IPSRemLan2.value = "";
	f.IPSRemLan3.value = "";
	f.IPSRemLan4.value = "";
	f.IPSRemLan_21.value = "";
	f.IPSRemLan_22.value = "";
	f.IPSRemLan_23.value = "";
	f.IPSRemLan_24.value = "";
	f.IPSRemLan_31.value ="";
	f.IPSRemLan_32.value = "";
	f.IPSRemLan_33.value = "";
	f.IPSRemLan_34.value = "";
	f.IPSRemLan_41.value ="";
	f.IPSRemLan_42.value = "";
	f.IPSRemLan_43.value = "";
	f.IPSRemLan_44.value = "";
	f.IPSRemMask1.value = "255";
	f.IPSRemMask2.value ="255";
	f.IPSRemMask3.value = "255";
	f.IPSRemMask4.value = "0";
	f.IPSLocLan1.value ="";
	f.IPSLocLan2.value = "";
	f.IPSLocLan3.value = "";
	f.IPSLocLan4.value = "";
	f.IPSLocMask1.value ="255";
	f.IPSLocMask2.value ="255";
	f.IPSLocMask3.value = "255";
	f.IPSLocMask4.value = "0";
}

function initOpenVpnForm(idx) {
	var f=document.form;

	f.vpnenable.value=st[idx].enable;
	f.profileType.value =st[idx].type;	
/*
	f.metric.value=st[idx].metric;
	f.dnstopptp.value=st[idx].dnstopptp;
*/
	f.newname.value=st[idx].name;
	f.username.value=st[idx].user;
	f.pass.value=st[idx].pass;

	f.vpnType.value=st[idx].vpn_type;

	//if(f.vpnType.value=="server") {
	// server
		f.vpnServerServerPort.value=st[idx].serverport;

		f.vpnServerServerPortType.value=st[idx].serverporttype;
		f.vpnServerAuthTypeValue.value=st[idx].vpn_authtype;
		f.vpnServerAuthUser.value=st[idx].user;
		f.vpnServerAuthPass.value=st[idx].pass;
	//}
	//else if(f.vpnType.value=="client") {
	// client
		f.vpnClientServerAddr.value=st[idx].serveraddress;
		f.vpnClientServerPort.value=st[idx].serverport;
		f.vpnClientServerPortType.value=st[idx].serverporttype;

		if(st[idx].defaultgw=="1")
			f.vpnClientServerGateway.checked=true;
		else
			f.vpnClientServerGateway.checked=false;

		f.vpnClientAuthTypeValue.value=st[idx].vpn_authtype;
		f.vpnClientAuthUser.value=st[idx].user;
		f.vpnClientAuthPass.value=st[idx].pass;
//	}
//	else if(f.vpnType.value=="peer") {
	// peer
		f.vpnPeerServerAddr.value=st[idx].serveraddress;
		f.vpnPeerServerPort.value=st[idx].serverport;
		f.vpnPeerServerPortType.value=st[idx].serverporttype;
		
/*
	}
	else {
		alert("Error: Unknown VPN mode found #1");
	}
*/

	f.vpnServerNwAddr.value=st[idx].network_addr;
	f.vpnNwMask.value=st[idx].network_mask;

	f.vpnLocalAddr.value=st[idx].local_ipaddr;
	f.vpnRemoteAddr.value=st[idx].remote_ipaddr;

	f.vpnCertiPeerNwAddr.value=st[idx].remote_nwaddr;
	f.vpnCertiPeerNwMask.value=st[idx].remote_nwmask;

	f.vpnClientCertiSel.value="";
	f.vpnClientCertiSel2.value=st[idx].certi;
/*
	f.vpnserver.value=st[idx].serveraddress;
	f.reconnectDelay.value = st[idx].reconnect_delay;
	f.reconnectRetries.value = st[idx].reconnect_retries;
	f.ttl.value = st[idx].ttl;
	f.snatEnable.value = st[idx].snat;
*/
}

// This routine translates an IP address (i.e in 192.168,etc form) to the individual
// segments needed to fill in the form in the web browser
function transformIPtoFormInfo(ipAddress, documentItem) {
	var ip=ipAddress.split(".");
	document.getElementById(documentItem+"1").value = ip[0];
	document.getElementById(documentItem+"2").value = ip[1];
	document.getElementById(documentItem+"3").value = ip[2];
	document.getElementById(documentItem+"4").value = ip[3];
}

function initIpsecForm(idx) {
	var f=document.form;
	var remote_gateway;
	var remote_lan;
	var remote_lan2;
	var remote_lan3;
	var remote_lan4;
	var remote_mask;
	var local_lan;
	var local_mask;

	f.vpnenable.value=st[idx].enable;
	f.newname.value=st[idx].name;
	f.profileType.value =st[idx].type;	
	f.ipsecEncap.value=st[idx].enccap_protocol;
	f.ipsecIKEMode.value=st[idx].ike_mode;
	f.ipsecPfs.value=st[idx].pfs;
	f.ipsecIKEEnc.value=st[idx].ike_enc;
	f.ipsecIKEHash.value=st[idx].ike_hash;
	f.ipsecEnc.value=st[idx].ipsec_enc;
	f.ipsecHash.value=st[idx].ipsec_hash;
	f.ipsecDpdaction.value=st[idx].ipsec_dpd;
	f.ipsecDHG.value=st[idx].ipsec_dhg;

	f.IpSecMethod.value=st[idx].ipsec_method;
	f.PskValue.value =st[idx].psk_value;
	f.PskRemoteId.value =st[idx].psk_remoteid;
	f.PskLocalId.value =st[idx].psk_localid;
	f.RsaRemoteId.value =st[idx].rsa_remoteid;
	f.RsaLocalId.value =st[idx].rsa_localid;
	f.KeyPassword.value =st[idx].key_password;
	f.RemGateway.value=st[idx].remote_gateway;
	f.RemLan.value=st[idx].remote_lan;
	f.RemMask.value=st[idx].remote_mask;
	f.LocLan.value=st[idx].local_lan;
	f.LocMask.value=st[idx].local_mask;
	f.IpsecLifeTime.value=st[idx].life_time;
	f.IpsecIkeTime.value=st[idx].ike_time;
	f.DpdTimeDelay.value=st[idx].dpd_time;
	f.DpdTimeout.value=st[idx].dpd_timeout;
	f.IPSRemGateway.value = st[idx].remote_gateway;
	remote_lan = st[idx].remote_lan.split(".");
	f.IPSRemLan1.value = remote_lan[0];
	f.IPSRemLan2.value = remote_lan[1];
	f.IPSRemLan3.value = remote_lan[2];
	f.IPSRemLan4.value = remote_lan[3];
	remote_lan2 = st[idx].remote_lan2.split(".");
	f.IPSRemLan_21.value = remote_lan2[0];
	f.IPSRemLan_22.value = remote_lan2[1];
	f.IPSRemLan_23.value = remote_lan2[2];
	f.IPSRemLan_24.value = remote_lan2[3];
	remote_lan3 = st[idx].remote_lan3.split(".");
	f.IPSRemLan_31.value = remote_lan3[0];
	f.IPSRemLan_32.value = remote_lan3[1];
	f.IPSRemLan_33.value = remote_lan3[2];
	f.IPSRemLan_34.value = remote_lan3[3];
	remote_lan4 = st[idx].remote_lan4.split(".");
	f.IPSRemLan_41.value = remote_lan4[0];
	f.IPSRemLan_42.value = remote_lan4[1];
	f.IPSRemLan_43.value = remote_lan4[2];
	f.IPSRemLan_44.value = remote_lan4[3];
	remote_mask = st[idx].remote_mask.split(".");
	f.IPSRemMask1.value = remote_mask[0];
	f.IPSRemMask2.value = remote_mask[1];
	f.IPSRemMask3.value = remote_mask[2];
	f.IPSRemMask4.value = remote_mask[3];
	local_lan = st[idx].local_lan.split(".");
	f.IPSLocLan1.value = local_lan[0];
	f.IPSLocLan2.value = local_lan[1];
	f.IPSLocLan3.value = local_lan[2];
	f.IPSLocLan4.value = local_lan[3];
	local_mask = st[idx].local_mask.split(".");
	f.IPSLocMask1.value = local_mask[0];
	f.IPSLocMask2.value = local_mask[1];
	f.IPSLocMask3.value = local_mask[2];
	f.IPSLocMask4.value = local_mask[3];
}
function showedit( myid, action, idx ) {
	document.form.editindex.value=idx;
	document.getElementById( myid+"Div" ).style['display']=action?"":"none";
	document.getElementById( myid+"Div1" ).style['display']=action?"":"none";
	document.getElementById( "listDiv" ).style['display']=action?"none":"";
	document.getElementById( "saveDiv" ).style['display']=action?"":"none";

	if( action ) {
		initEmptyForm(idx);
		if( idx < st.length ) {
			if(st[idx].type=="pptp.0" ||st[idx].type=="gre.0") {
				initPptpForm(idx);
				initGreForm(idx);
			}
			else if(st[idx].type=="openvpn.0") {
				initOpenVpnForm(idx);
			}
			else  {
				initIpsecForm(idx);
				setKeyMode();
				UpdateIpsecCertInfo();
			}
		}
	}
	else {
		document.form.editindex.value=-1;
	}
	updateFormArrange();

	setVpnEnable(document.form.vpnenable.value);
	updateVpnInfo();
}

function bodyOnLoad() {
	setKeyMode();
}

function readElement(elementName) {
	var element;

	element=document.getElementById(elementName);
	if( (typeof(element)=="undefined") || (element==null) ) {
		alert("not found - " + elementName);
		return "";
	}
	return document.getElementById(elementName).value;
}

function enableElement(elementName,ena) {
	document.getElementById(elementName).disabled=!ena;
}

function checkElement(elementName,check) {
	document.getElementById(elementName).checked=check;
}

function showElement(elementName,show) {
	document.getElementById(elementName).style['display']=show?"":"none";
}

// re-arrange server elements (vpn auth type - certi and unpw)
function setVpnServerAuthType(auth) {
	// change radio button
	document.getElementById("vpnServerAuthTypeValue").value=auth;
	updateFormArrange();
}

function updateFormArrange() {
	profileType=readElement("profileType");
	vpnEnable=readElement("vpnenable");

	// peripheral divisions
	showElement("serverAddDiv",(profileType=="pptp.0") || (profileType=="gre.0"));
	showElement("miscDiv",(profileType=="pptp.0") || (profileType=="gre.0"));

	// pptp
	//////////////////////////////////////////////
	showElement("pptpDiv",profileType=="pptp.0");
	
	// gre
	showElement("greDiv",profileType=="gre.0");
	
	// open vpn
	showElement("vpnDiv",profileType=="openvpn.0");

	vpnType=readElement("vpnType");
		// server
		showElement("vpnServerDiv",vpnType=="server");

		serverAuthType=readElement("vpnServerAuthTypeValue");
		checkElement("vpnServerAuthTypeCerti",(serverAuthType==0) || (serverAuthType==""));
		checkElement("vpnServerAuthTypeUNPW",serverAuthType==1);
		showElement("vpnServerAuthCertiDiv",(serverAuthType==0) || (serverAuthType==""));
		showElement("vpnServerAuthUnpwDiv",serverAuthType==1);

		// client
		showElement("vpnClientDiv",vpnType=="client");
		clientAuthType=readElement("vpnClientAuthTypeValue");
		checkElement("vpnClientAuthTypeCerti",(clientAuthType==0) || (clientAuthType==""));
		checkElement("vpnClientAuthTypeUNPW",clientAuthType==1);
		showElement("vpnClientAuthCertiSubjectDiv",true);
		showElement("vpnClientAuthCerti3Div",(clientAuthType==0) || (clientAuthType==""));
		showElement("vpnClientAuthCertiDiv",(clientAuthType==0) || (clientAuthType==""));
		showElement("vpnClientAuthUnpwDiv",clientAuthType==1);

		// peer
		showElement("vpnPeerDiv",vpnType=="peer");
	
	// open vpn updown divistion
	showElement("vpn2Div",(profileType=="openvpn.0") && (vpnType!="server"));
	showElement("vpnCaUpDiv",(profileType=="openvpn.0") && (vpnType=="client") && (clientAuthType==1));
	showElement("vpnCertiUpDiv",(profileType=="openvpn.0") && (vpnType=="client") && (clientAuthType==0 || clientAuthType==""));
	showElement("vpnSecretUpDiv",(profileType=="openvpn.0") && (vpnType=="peer"));

	//IPsec
	showElement("ipsecDiv",profileType=="ipsec.0");
	IpSecMethod = readElement("IpSecMethod");
	showElement("ipsecCertsDiv", (profileType=="ipsec.0") && (IpSecMethod == "cert"));
	showElement("ipsecFormCertDiv", (profileType=="ipsec.0") && (IpSecMethod == "cert"));
	showElement("ipsecRemoteRsaDiv", (profileType=="ipsec.0") && (IpSecMethod == "rsa"));
	showElement("ipsecLocalRsaDiv", (profileType=="ipsec.0") && (IpSecMethod == "rsa"));
	showElement("ipsecRsaKeyDiv",  (profileType=="ipsec.0") && (IpSecMethod == "rsa"));
	showElement("ipsecPresharedKeyDiv",  (profileType=="ipsec.0") && (IpSecMethod == "psk"));

	var f=document.form;
	remoteLan2head = f.IPSRemLan_21.value;
	remoteLan3head = f.IPSRemLan_31.value;
	remoteLan4head = f.IPSRemLan_41.value;

	showElement("remoteLan2MoreDiv",  (profileType=="ipsec.0") && (remoteLan2head != ""))
	showElement("remoteLan3MoreDiv",  (profileType=="ipsec.0") && (remoteLan3head != ""))
	showElement("remoteLan4MoreDiv",  (profileType=="ipsec.0") && (remoteLan4head != ""))
/*
	vpnCaUpDiv
	vpnCertiUpDiv
*/
}

// re-arrange client elements (vpn auth type - certi and unpw)
function setVpnClientAuthType(auth) {
	document.getElementById("vpnClientAuthTypeValue").value=auth;
	updateFormArrange();
}

function setVpnClientCerti(thisValue) {
	var cce;
	var cc;
	var cc2;

	if(typeof(installed_certificate)=="undefined" || typeof(installed_certificate[thisValue])=="undefined") {
		cc=["","","","","",""];
		cc2=["","","","","",""];
		cc3=["N/A","N/A"];
	}
	else {
		cce=installed_certificate[thisValue].split("/");
		cc=cce[0].split(",");
		cc2=cce[1].split(",");
		cc3=cce[2].split(",");
	}

	document.getElementById("vpnClientCertiSel2").value=readValueWithDef(cc2[4],"");
	document.getElementById("vpnCertiExpS").value=readValueWithDef(cc3[0],"N/A");
	document.getElementById("vpnCertiExpE").value=readValueWithDef(cc3[1],"N/A");
	document.getElementById("vpnCertiCountry2").value=readValueWithDef(cc[0],"");
	document.getElementById("vpnCertiState2").value=readValueWithDef(cc[1],"");
	document.getElementById("vpnCertiCity2").value=readValueWithDef(cc[2],"");
	document.getElementById("vpnCertiOrg2").value=readValueWithDef(cc[3],"");
	document.getElementById("vpnCertiName2").value=readValueWithDef(cc[4],"");
	document.getElementById("vpnCertiEmail2").value=readValueWithDef(cc[5],"");
	
	document.getElementById("vpnCertiCountry3").value=readValueWithDef(cc2[0],"");
	document.getElementById("vpnCertiState3").value=readValueWithDef(cc2[1],"");
	document.getElementById("vpnCertiCity3").value=readValueWithDef(cc2[2],"");
	document.getElementById("vpnCertiOrg3").value=readValueWithDef(cc2[3],"");
	document.getElementById("vpnCertiName3").value=readValueWithDef(cc2[4],"");
	document.getElementById("vpnCertiEmail3").value=readValueWithDef(cc2[5],"");
}

function readValueWithDef(val,def) {
	if( (typeof(val)=="undefined") || (val==null) )
		return def;
	return val;
}

function vpnSecretServerKeyGenBtnClick() {
	var req="/cgi-bin/vpn_action.cgi?action=gensecret";
	var ajaxDelCerti = cretaeAjax();
	
	ajaxDelCerti.onreadystatechange = function() {
		if (ajaxDelCerti.readyState != 4)
			return;

		document.getElementById("vpnSecretServerKeyGenBtn").disabled = false;
		document.body.style.cursor = 'default';
		
		if (ajaxDelCerti.status != 200) {
			return;
		}

		var result;
		eval(ajaxDelCerti.responseText);
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		updateVpnInfo();
	}
	document.getElementById("vpnSecretServerKeyGenBtn").disabled = true;
	document.body.style.cursor = 'wait';
	ajaxDelCerti.open('GET', req, true);
	ajaxDelCerti.send(null);
}

function vpnSecretClientUpBtnClick() {
	document.getElementById("vpnSecretUpSubaction").value="upsecret";
	document.getElementById("uploadfile").value=document.getElementById("secretfile").value;
	document.getElementById("vpnSecretUpParam").value="";
	document.getElementById("formVpnSecretUp").submit();
}

function vpnClientDelCertiBtnClick() {
	certiName=document.getElementById("vpnCertiName3").value;

	var req="/cgi-bin/vpn_action.cgi?action=delclient&param="+certiName;
	var ajaxDelClient = cretaeAjax();

	ajaxDelClient.onreadystatechange = function() {
		if (ajaxDelClient.readyState != 4)
			return;

		document.getElementById("vpnClientDelCertiBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxDelClient.status != 200) {
			return;
		}

		var result;
		eval(ajaxDelClient.responseText);
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("The delete operation has failed. Please check the connection the the router");
				return;
		}
		updateVpnInfo();
	}

	document.getElementById("vpnClientDelCertiBtn").disabled = true;
	document.body.style.cursor = 'wait';

	ajaxDelClient.open('GET', req, true);
	ajaxDelClient.send(null);
}

function vpnSecretClientDelBtnClick() {
	var req="/cgi-bin/vpn_action.cgi?action=delsecret";
	var ajaxDelSec = cretaeAjax();

	ajaxDelSec.onreadystatechange = function() {
		if (ajaxDelSec.readyState != 4)
			return;

		document.getElementById("vpnSecretClientDelBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxDelSec.status != 200) {
			return;
		}

		var result;
		eval(ajaxDelSec.responseText);
		
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		updateVpnInfo();
	}

	document.getElementById("vpnSecretClientDelBtn").disabled = true;
	document.body.style.cursor = 'wait';

	ajaxDelSec.open('GET', req, true);
	ajaxDelSec.send(null);
}

function vpnSecretServerKeyDnBtnClick() {
	document.getElementById("dn_action").value="dnsecret";
	document.getElementById("dn_param").value="";
	document.getElementById("formVpnActionDn").submit();
}

function vpnCertiCaNwSetBtnClick() {
	certiName="ca"
	nwaddr=document.getElementById("vpnCertiCaNwAddr").value;
	nwmask=document.getElementById("vpnCertiCaNwMask").value;
	
	regaddr=/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/
	
	if(nwaddr.length>0 || nwmask.length>0) {
		if(regaddr.exec(nwaddr)==null) {
			alert("Please ensure you enter correct network address");
			return;
		}
		
		if(regaddr.exec(nwmask)==null) {
			alert("Please ensure you enter correct network mask");
			return;
		}
	}

	var req="/cgi-bin/vpn_action.cgi?action=setclientnw&param="+certiName+","+nwaddr+","+nwmask;
	var ajaxSetClntNw = cretaeAjax();

	ajaxSetClntNw.onreadystatechange = function() {
		if (ajaxSetClntNw.readyState != 4)
			return;

		document.getElementById("vpnCertiCaNwSetBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxSetClntNw.status != 200) {
			return;
		}

		var result;
		eval(ajaxSetClntNw.responseText);
		
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		updateVpnInfo();
	}

	document.getElementById("vpnCertiCaNwSetBtn").disabled = true;
	document.body.style.cursor = 'wait';

	ajaxSetClntNw.open('GET', req, true);
	ajaxSetClntNw.send(null);
}

function vpnCertiNwSetBtnClick() {
	certiName=document.getElementById("vpnCertiName").value;
	nwaddr=document.getElementById("vpnCertiNwAddr").value;
	nwmask=document.getElementById("vpnCertiNwMask").value;

	regaddr=/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/

	if(nwaddr.length>0 || nwmask.length>0) {
		if(regaddr.exec(nwaddr)==null) {
			alert("Please ensure you enter correct network address");
			return;
		}
		
		if(regaddr.exec(nwmask)==null) {
			alert("Please ensure you enter correct network mask");
			return;
		}
	}

	var req="/cgi-bin/vpn_action.cgi?action=setclientnw&param="+certiName+","+nwaddr+","+nwmask;
	var ajaxSetClntNw = cretaeAjax();

	ajaxSetClntNw.onreadystatechange = function() {
		if (ajaxSetClntNw.readyState != 4)
			return;

		document.getElementById("vpnCertiNwSetBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxSetClntNw.status != 200) {
			return;
		}

		var result;
		eval(ajaxSetClntNw.responseText);

		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		updateVpnInfo();
	}

	document.getElementById("vpnCertiNwSetBtn").disabled = true;
	document.body.style.cursor = 'wait';
	
	ajaxSetClntNw.open('GET', req, true);
	ajaxSetClntNw.send(null);
}

function vpnServerRmClientBtnClick() {
	certiName=document.getElementById("vpnCertiName").value;
	var req="/cgi-bin/vpn_action.cgi?action=rmclient&param="+certiName;
	var ajaxRmClient = cretaeAjax();

	ajaxRmClient.onreadystatechange = function() {
		if (ajaxRmClient.readyState != 4)
			return;

		document.getElementById("vpnServerRmClientBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxRmClient.status != 200) {
			return;
		}

		var result;
		eval(ajaxRmClient.responseText);

		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		updateVpnInfo();
	}

	document.getElementById("vpnServerRmClientBtn").disabled = true;
	document.body.style.cursor = 'wait';

	ajaxRmClient.open('GET', req, true);
	ajaxRmClient.send(null);
}

function vpnServerDnCertiBtnClick() {
	document.getElementById("dn_action").value="dnca";
	document.getElementById("dn_param").value="";
	document.getElementById("formVpnActionDn").submit();
}

function vpnServerDnClientBtnClick() {
	certiName=document.getElementById("vpnCertiName").value;
	document.getElementById("dn_action").value="dnclient";
	document.getElementById("dn_param").value=certiName;
	document.getElementById("formVpnActionDn").submit();
}

function setVpnServerCerti(thisValue) {
	divArray=[
		"vpnCertiName",
		"vpnCertiCountry",
		"vpnCertiState",
		"vpnCertiCity",
		"vpnCertiOrg",
		"vpnCertiEmail",
	];

	editable=(thisValue<0) || typeof(client_certificate)=="undefined" || typeof(client_certificate[thisValue])=="undefined";

	var i;
	for(i=0;i<divArray.length;i++) {
		if(document.getElementById( divArray[i] )==null)
			continue;

		document.getElementById( divArray[i] ).readOnly=!editable;
		if(editable)
			document.getElementById( divArray[i] ).setAttribute("class","");
		else
			document.getElementById( divArray[i] ).setAttribute("class","certi_menu_item");
	}

	// buttons
	document.getElementById("vpnServerGenClientBtn").disabled=!editable;
	document.getElementById("vpnServerDnClientBtn").disabled=editable;
	document.getElementById("vpnServerRmClientBtn").disabled=editable;
	showElement("vpnCertiRev",!editable);
	showElement("vpnCertiRevText",!editable);
	
	// network information
	enableElement("vpnCertiNwSetBtn",!editable);
	enableElement("vpnCertiNwMask",!editable);
	enableElement("vpnCertiNwAddr",!editable);

	// bypass if new
	if(editable) {
		cc=["","","","","","","","",""];
	}
	else {
		// get cc
		cc=client_certificate[thisValue].split(",");
	}

	document.getElementById("vpnCertiCountry").value=readValueWithDef(cc[1],"");
	document.getElementById("vpnCertiState").value=readValueWithDef(cc[2],"");
	document.getElementById("vpnCertiCity").value=readValueWithDef(cc[3],"");
	document.getElementById("vpnCertiOrg").value=readValueWithDef(cc[4],"");
	document.getElementById("vpnCertiName").value=readValueWithDef(cc[5],"");
	document.getElementById("vpnCertiEmail").value=readValueWithDef(cc[6],"");
	document.getElementById("vpnCertiRev").value=readValueWithDef(cc[7],"");
	
	// client network information
	nwinfo=cc[8].split(" ");
	document.getElementById("vpnCertiNwAddr").value=readValueWithDef(nwinfo[0],"");
	document.getElementById("vpnCertiNwMask").value=readValueWithDef(nwinfo[1],"");
}

function cretaeAjax() {
	var ajaxHttp;    
	try {
		ajaxHttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	catch (e) {  // Internet Explorer  
		try {
			ajaxHttp = new ActiveXObject("Msxml2.XMLHTTP");
		}
		catch (e) {
			try {
				// Firefox, Opera 8.0+, Safari
				ajaxHttp = new XMLHttpRequest();

			}
			catch (e) {
				alert("Your browser does not support AJAX!");
				return false;
			}
		}
	}      
	return ajaxHttp;
}

function updateVpnInfoDh_handler(responseText,callVpn) {
	var result;
	var openvpn_dh=0;
	var openvpn_output=[];

	eval(responseText);
	document.getElementById("vpnDhOutput").value=openvpn_output;
	if(openvpn_dh==2)
		setTimeout("updateVpnInfoDh()", 500)
	else {
		if(callVpn)
			updateVpnInfo();
	}
}

var ajaxUpdVpnDhInfo = null;
var ajaxUpdVpnInfo = null;

function updateVpnInfoDh() {
	var req="/cgi-bin/vpn_action.cgi?action=info_dh";

	if(ajaxUpdVpnDhInfo)
		return;

	ajaxUpdVpnDhInfo = cretaeAjax();
	ajaxUpdVpnDhInfo.onreadystatechange = function() {
		if (ajaxUpdVpnDhInfo.readyState != 4) {
			return;
		}
		if (ajaxUpdVpnDhInfo.status != 200) {
			ajaxUpdVpnDhInfo=null;
			return;
		}
		updateVpnInfoDh_handler(ajaxUpdVpnDhInfo.responseText,true);
		ajaxUpdVpnDhInfo=null;
	}
	ajaxUpdVpnDhInfo.open('GET', req, true);
	ajaxUpdVpnDhInfo.send(null);
}

function updateVpnInfo() {
	if(ajaxUpdVpnInfo)
		return;

	var req="/cgi-bin/vpn_action.cgi?action=info";
	var vpnServerCertiSel=document.getElementById('vpnServerCertiSel');
	var vpnClientCertiSel=document.getElementById('vpnClientCertiSel');
	var vpnClientCertiSel2=document.getElementById('vpnClientCertiSel2');
	ajaxUpdVpnInfo = cretaeAjax();

	ajaxUpdVpnInfo.onreadystatechange = function() {
		if (ajaxUpdVpnInfo.readyState != 4)
			return;

		vpnServerCertiSel.disabled = false;
		vpnClientCertiSel.disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxUpdVpnInfo.status != 200) {
			ajaxUpdVpnInfo=null;
			return;
		}

		var result;
		eval(ajaxUpdVpnInfo.responseText);
		
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}

		// clear client select
		while(vpnServerCertiSel.length)
			vpnServerCertiSel.remove(0);

		// add clients
		var i;
		for(i=0;client_certificate!=null && i<client_certificate.length;i++) {
			var elOptNew = document.createElement('option');

			cc=client_certificate[i].split(",");
			elOptNew.text = cc[5];
			elOptNew.value = i;
			elOptNew.selected == (i==0);
			try {
				vpnServerCertiSel.add(elOptNew,null);
			}
			catch(ex) {
				vpnServerCertiSel.add(elOptNew);
			}
		}

		var elOptNew = document.createElement('option');
		elOptNew.text = "New..."
		elOptNew.value = "-1";

		try {
			vpnServerCertiSel.add(elOptNew,null);
		}
		catch(ex) {
			vpnServerCertiSel.add(elOptNew);
		}

		// update position
		setVpnServerCerti(vpnServerCertiSel.value);

		// backup the value
		if(vpnClientCertiSel.value!="" && vpnClientCertiSel.value<installed_certificate.length) {
			cce=installed_certificate[vpnClientCertiSel.value].split("/");
			cc=cce[0].split(",");
			cc2=cce[1].split(",");
			
			vpnClientCertiSel2.value=cc2[4];
		}

		// clear installed certificate
		while(vpnClientCertiSel.length)
			vpnClientCertiSel.remove(0);

		var found=0;
		// add installed certificate
		for(i=0;installed_certificate!=null && i<installed_certificate.length;i++) {
			var elOptNew = document.createElement('option');

			cce=installed_certificate[i].split("/");
			cc=cce[0].split(",");
			cc2=cce[1].split(",");

			elOptNew.text = cc[4] + " - " + cc2[4];
			elOptNew.value = i;

			if(cc2[4] == vpnClientCertiSel2.value) {
				elOptNew.selected = true;
				found=i;
			}
			else {
				elOptNew.selected = false;
			}

			try {
				vpnClientCertiSel.add(elOptNew,null);
			}
			catch(ex) {
				vpnClientCertiSel.add(elOptNew);
			}
		}

		// update position
		setVpnClientCerti(found);
		enableElement("vpnClientDelCertiBtn",installed_certificate!=null && installed_certificate.length>0);

		// secret time - server
		serverSecretTime=server_secret_time;
		if(serverSecretTime=="")
			serverSecretTime="N/A";
		document.getElementById("vpnSecretServerKeyTime").value=serverSecretTime;

		// secret time - client
		clientSecretTime=client_secret_time;
		if(clientSecretTime=="")
			clientSecretTime="N/A";
		document.getElementById("vpnSecretClientKeyTime").value=clientSecretTime;

		// server certificate
		if(server_certificate!=null) {
			cce=server_certificate.split("/");
			cc=cce[0].split(",");
			cc2=cce[1].split(",");
			cc3=cce[2].split(" ");
		}
		else {
			cc="";
			cc2="";
			cc3=["",""];
		}

		serverCertiExpS=readValueWithDef(cc2[0],"N/A");
		if(serverCertiExpS=="")
			serverCertiExpS="N/A";

		serverCertiExpE=readValueWithDef(cc2[1],"N/A");
		if(serverCertiExpE=="")
			serverCertiExpE="N/A";

		if(cc3.length==2) {
			document.getElementById("vpnCertiCaNwAddr").value=cc3[0];
			document.getElementById("vpnCertiCaNwMask").value=cc3[1];
		}
		else {
			document.getElementById("vpnCertiCaNwAddr").value="";
			document.getElementById("vpnCertiCaNwMask").value="";
		}

		// openvpn dh
		updateVpnInfoDh_handler(ajaxUpdVpnInfo.responseText,false);

		document.getElementById("vpnServerCertiExpS").value=serverCertiExpS;
		document.getElementById("vpnServerCertiExpE").value=serverCertiExpE;
		document.getElementById("vpnCertiCountry4").value=readValueWithDef(cc[0],"");
		document.getElementById("vpnCertiState4").value=readValueWithDef(cc[1],"");
		document.getElementById("vpnCertiCity4").value=readValueWithDef(cc[2],"");
		document.getElementById("vpnCertiOrg4").value=readValueWithDef(cc[3],"");
		document.getElementById("vpnCertiEmail4").value=readValueWithDef(cc[5],"");

		enableElement("vpnServerGenDhBtn",typeof(openvpn_dh)=="undefined" || openvpn_dh!=2);
		// enable elements
		serverCertiExisting=(cc2[0]!="") && (cc2[1]!="");
		dhExisting=typeof(openvpn_dh)!="undefined" && openvpn_dh==1;
		if(!serverCertiExisting || !dhExisting)
			enableElement("vpnServerGenClientBtn",false);
		enableElement("vpnServerDnCertiBtn",serverCertiExisting && dhExisting);
		// enable elements
		enableElement("vpnSecretServerKeyDnBtn",server_secret_time!="");
		enableElement("vpnSecretClientDelBtn",client_secret_time!="");
		// enable elements
		enableElement("vpnServerGenCertiBtn",dhExisting);
		showElement("vpnDhOutput",typeof(openvpn_output)!="undefined" && openvpn_output.length>0);
		
		ajaxUpdVpnInfo=null;
	}

	vpnServerCertiSel.disabled = true;
	vpnClientCertiSel.disabled = true;
	document.body.style.cursor = 'wait';

	ajaxUpdVpnInfo.open('GET', req, true);
	ajaxUpdVpnInfo.send(null);
}

function isIncorrect(xStr) {  
	var regEx = /^[a-zA-Z0-9@_\-\. ]+$/;
	return !xStr.match(regEx);  
}  

function vpnServerGenClientBtnClick() {
	certiName=document.getElementById("vpnCertiName").value;
	countryName=document.getElementById("vpnCertiCountry").value;
	certiState=document.getElementById("vpnCertiState").value;
	certiCity=document.getElementById("vpnCertiCity").value;
	certiOrg=document.getElementById("vpnCertiOrg").value;
	certiEmail=document.getElementById("vpnCertiEmail").value;

	if(isIncorrect(certiName)) {
		alert("ERROR: Please ensure you enter a correct certificate name");
		return;
	}

	if(countryName.length>2 || isIncorrect(countryName)) {
		alert("ERROR: Please ensure you enter 1 or 2 letters country name");
		return;
	}

	if(isIncorrect(certiState) || isIncorrect(certiCity) || isIncorrect(certiOrg) || isIncorrect(certiEmail)) {
		alert("ERROR: Please ensure you input certificate fields");
		return;
	}

	certiState

	var req="/cgi-bin/vpn_action.cgi?action=genclient&param="
		+document.getElementById("vpnCertiName").value+","
		+countryName+","
		+document.getElementById("vpnCertiState").value+","
		+document.getElementById("vpnCertiCity").value+","
		+document.getElementById("vpnCertiOrg").value+","
		+document.getElementById("vpnCertiEmail").value;

	var ajaxGenClnt = cretaeAjax();
	
	ajaxGenClnt.onreadystatechange = function() {
		if (ajaxGenClnt.readyState != 4)
			return;
			
		document.getElementById('vpnServerGenClientBtn').disabled = false;
		document.body.style.cursor = 'default';
		
		if (ajaxGenClnt.status != 200) {
			return;
		}
		
		var result;
		eval(ajaxGenClnt.responseText);
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("The router failed to generate the client key. Please ensure you enter correct certificate information");
		}
		else {
			updateVpnInfo();
		}
	}

	document.getElementById('vpnServerGenClientBtn').disabled = true;
	document.body.style.cursor = 'wait';

	ajaxGenClnt.open('GET', req, true);
	ajaxGenClnt.send(null);
}

function vpnServerGenDhClick() {
	if(!confirm("INFO: It will take up to 20 minutes to generate DH parameters. All the previously generated server and client keys will be deleted and invalidated by this procedure. Are you sure you want to continue?"))
		return;

	var req="/cgi-bin/vpn_action.cgi?action=init&param=";
	var ajaxGenDh = cretaeAjax();

	ajaxGenDh.onreadystatechange = function() {
		if (ajaxGenDh.readyState != 4)
			return;
			
		document.getElementById('vpnServerGenDhBtn').disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxGenDh.status != 200) {
			return;
		}

		var result;
		eval(ajaxGenDh.responseText);
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("The router failed to start to generate the DH key.");
		}
		
		updateVpnInfo();
	}

	document.getElementById('vpnServerGenDhBtn').disabled = true;
	document.body.style.cursor = 'wait';

	ajaxGenDh.open('GET', req, true);
	ajaxGenDh.send(null);
}

function vpnServerGenCertiBtnClick() {
	countryName=document.getElementById("vpnCertiCountry4").value;
	certiState=document.getElementById("vpnCertiState4").value;
	certiCity=document.getElementById("vpnCertiCity4").value;
	certiOrg=document.getElementById("vpnCertiOrg4").value;
	certiEmail=document.getElementById("vpnCertiEmail4").value;

	if(countryName.length>2 || isIncorrect(countryName)) {
		alert("ERROR: Please ensure you enter 1 or 2 letters country name");
		return;
	}

	if(isIncorrect(certiState) || isIncorrect(certiCity) || isIncorrect(certiOrg) || isIncorrect(certiEmail)) {
		alert("ERROR: Please ensure you input certificate fields");
		return;
	}

	if(!confirm("INFO: It will take about a minute to generate new CA and server keys. All the previously generated client keys will be invalidated by this procedure. Are you sure you want to continue?"))
		return;

	var req="/cgi-bin/vpn_action.cgi?action=ca&param="
		+","
		+countryName+","
		+document.getElementById("vpnCertiState4").value+","
		+document.getElementById("vpnCertiCity4").value+","
		+document.getElementById("vpnCertiOrg4").value+","
		+document.getElementById("vpnCertiEmail4").value;

	var ajaxGenCa = cretaeAjax();
	ajaxGenCa.onreadystatechange = function() {
		if (ajaxGenCa.readyState != 4)
			return;
			
		document.getElementById('vpnServerGenCertiBtn').disabled = false;
		document.body.style.cursor = 'default';
		
		if (ajaxGenCa.status != 200) {
			return;
		}
		
		var result;
		eval(ajaxGenCa.responseText);
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("The router failed to generate the CA key. Please ensure you enter correct certificate information");
		}
		
		updateVpnInfo();
	}

	document.getElementById('vpnServerGenCertiBtn').disabled = true;
	document.body.style.cursor = 'wait';

	ajaxGenCa.open('GET', req, true);
	ajaxGenCa.send(null);
}

function vpnCaUpBtnClick() {
	document.getElementById("vpnCaUpParam").value=document.getElementById("vpnCaUpName").value;
	uploadTargetStart(document.getElementById("formVpnCaUp"));
}

var upload_running=false;

function uploadTargetStart(form) {
	form.target = "uploadTarget";
	document.getElementById("uploadTarget").onload = uploadTargetOnLoad;
	form.submit();

	// disable certi
	enableElement("vpnCertiUpBtn",false);
	enableElement("vpnCertiUpFile",false);
	// disable secret
	enableElement("vpnSecretUpBtn",false);
	enableElement("vpnSecretUpFile",false);
	// disable ca
	enableElement("vpnCaUpFile",false);
	enableElement("vpnCaUpName",false);
	enableElement("vpnCaUpBtn",false);

	document.body.style.cursor = 'wait';
	upload_running=true;
}

function resetForm(formName) {
	document.getElementById(formName).reset();
}

function uploadTargetOnLoad() {
	if(upload_running) {
		//Function will be called when iframe is loaded
		var ret = frames['uploadTarget'].document.getElementsByTagName("body")[0].innerHTML;

		//window.location.reload(true);
		eval(ret);

		if ( typeof(result)=="undefined" || result!="ok" ) {
			alert("The upload operation has failed. Please ensure the connection to the router");
			return;
		}
	}

	document.body.style.cursor = 'default';

	// reset certi
	resetForm("formVpnCertiUp");
	enableElement("vpnCertiUpFile",true);
	// reset secret
	resetForm("formVpnSecretUp");
	enableElement("vpnSecretUpFile",true);
	// reset ca
	resetForm("formVpnCaUp");
	enableElement("vpnCaUpFile",true);
	enableElement("vpnCaUpName",true);

	updateVpnInfo();
	upload_running=false;
} 


function vpnCaUpFileChange() {
	selected= (document.getElementById("vpnCaUpFile").value.length>0) && (document.getElementById("vpnCaUpName").value.length>0);
	document.getElementById("vpnCaUpBtn").disabled=!selected;
}

function vpnCertiUpFileChange() {
	selected=document.getElementById("vpnCertiUpFile").value.length>0;
	document.getElementById("vpnCertiUpBtn").disabled=!selected;
}

function vpnSecretUpFileChange() {
	selected=document.getElementById("vpnSecretUpFile").value.length>0;
	document.getElementById("vpnSecretUpBtn").disabled=!selected;
}

//ipsec
function ipsecRoadWarrior() {
	var f=document.form;
	f.IPSRemGateway.value = "0.0.0.0";

	f.IPSRemLan1.value = 0;
	f.IPSRemLan2.value = 0;
	f.IPSRemLan3.value = 0;
	f.IPSRemLan4.value = 0;
}

function UpdateIpsecCertInfo() {
	editIndex = document.form.editindex.value;
	if(editIndex<st.length)
		profileNum= st[editIndex].profilenum;
	else
		profileNum=newprofilenum;

	var req="/cgi-bin/ipsec_action.cgi?action=certinfo&param="+ profileNum;
	
	var ajaxRmClient = cretaeAjax();

	ajaxRmClient.onreadystatechange = function() {
		if (ajaxRmClient.readyState != 4)
			return;

		document.body.style.cursor = 'default';
		if (ajaxRmClient.status != 200) {
			return;
		}

		var result;
		ipsec_clear_cert_info();
		document.getElementById('keyText').innerHTML = ajaxRmClient.responseText;
		eval(ajaxRmClient.responseText);
		
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
		setCertificateText();
	}
	document.body.style.cursor = 'wait';
	ajaxRmClient.open('GET', req, true);
	ajaxRmClient.send(null);
}

function ipsecRmCertBtnClick() {
	certiName=document.getElementById("ipsecCertiName").value;
	var req="/cgi-bin/ipsec_action.cgi?action=rmcert&param="+certiName;
	var ajaxRmClient = cretaeAjax();

	ajaxRmClient.onreadystatechange = function() {
		if (ajaxRmClient.readyState != 4)
			return;

		document.getElementById(" ipsecRmCertBtn").disabled = false;
		document.body.style.cursor = 'default';

		if (ajaxRmClient.status != 200) {
			return;
		}

		var result;
		eval(ajaxRmClient.responseText);		
		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
	}

	document.getElementById(" ipsecRmCertBtn").disabled = true;
	document.body.style.cursor = 'wait';
	ajaxRmClient.open('GET', req, true);
	ajaxRmClient.send(null);
}

function ipsecSecretKeyGenBtnClick() {
	if(!confirm("INFO: Before generate RSA key,make sure ipsec is running with at least one tunnel. Save it before generating will gurantee ipsec is running"))
	return;
	
	if(!confirm("INFO: Genarating RSA key will erase the old key present, are you going to continue...?"))
	return;

	editIndex = document.form.editindex.value;

	var req="/cgi-bin/ipsec_action.cgi?action=genrsa&param="+ st[editIndex].profilenum;
	var ajaxGenRsa = cretaeAjax();

	ajaxGenRsa.onreadystatechange = function() {
		if (ajaxGenRsa.readyState != 4)
			return;

		document.getElementById("ipsecSecretKeyGenBtn").disabled = false;
		document.body.style.cursor = 'default';
		
		if (ajaxGenRsa.status != 200) {
			return;
		}

		var result;
		eval(ajaxGenRsa.responseText);

		if ( typeof(result)=="undefined" || result!="ok" ) {
				alert("failed");
				return;
		}
	}
	document.getElementById("ipsecSecretKeyGenBtn").disabled = true;
	document.body.style.cursor = 'wait';

	ajaxGenRsa.open('GET', req, true);
	ajaxGenRsa.send(null);
}

function ipsecDnRsaBtnClick() {
	editIndex = document.form.editindex.value;
	document.getElementById("ipsec_dn_action").value="dnrsa";
	document.getElementById("ipsec_dn_param").value= st[editIndex].profilenum;
	document.getElementById("formIpsecActionDn").submit();
}

function ipsecCertiUpFileChange() {
	var f1 = document.getElementById("ipsecCertiUpFile").value;
	var end = f1.indexOf(".pem"); 
	if(end == -1){ 
		end = f1.indexOf(".crt"); 
		if(end == -1) {
			end = f1.indexOf(".key"); 
			if(end == -1) {
				alert("Error: Wrong Type of File! File must end in .crt, .key or .pem");
				document.getElementById("ipsecCertiUpParam").disabled= true;
				return;
			}
		}
	}
	var f = document.form;

	var rc = getCheckedValue(f.uploadFileType);
	if (rc == "") {
		alert("Choose a File Type on above: Key or Certificate.");
		return;
	}

	selected=document.getElementById("ipsecCertiUpFile").value.length>0;
	document.getElementById("ipsecCertiUpBtn").disabled=!selected;
	editIndex = document.form.editindex.value;
	profileNum=st[editIndex].profilenum;
	certFileName =  document.getElementById("ipsecCertiUpFile").value;
	document.getElementById("ipsecCertiUpParam").value= profileNum+ "&"+certFileName + "&"+rc ;
}

function ipsecRsaUpFileChange() {
	editIndex = document.form.editindex.value;
	selected=document.getElementById("ipsecRsaUpFile").value.length>0;
	document.getElementById("ipsecRsaUpParam").value= st[editIndex].profilenum;
	document.getElementById("ipsecRsaUpBtn").disabled=!selected;

	var f1 = document.getElementById("ipsecRsaUpFile").value;
	var end = f1.indexOf(".key"); 
	if(end == -1){ 
		alert("Error: Wrong Type of File! File must end in .key");
		document.getElementById("ipsecRsaUpBtn").disabled= true;
	}
}

function ipsecLocalRsaUpFileChange() {
	editIndex = document.form.editindex.value;
	selected=document.getElementById("ipsecLocalRsaUpFile").value.length>0;
	document.getElementById("ipsecLocalRsaUpParam").value= st[editIndex].profilenum;
	document.getElementById("ipsecLocalRsaUpBtn").disabled=!selected;

	var f1 = document.getElementById("ipsecLocalRsaUpFile").value;
	var end = f1.indexOf(".key"); 
	if(end == -1){ 
		alert("Error: Wrong Type of File! File must end in .key");
		document.getElementById("ipsecLocalRsaUpBtn").disabled= true;
	}
}


function ipsecUploadTargetStart(form) {
	form.target = "uploadTarget";
	document.getElementById("uploadTarget").onload = ipsecUploadTargetOnLoad;
	form.submit();

	// disable Remote Rsa
	enableElement("ipsecRsaUpBtn",false);
	enableElement("ipsecRsaUpFile",false);

	// disable Local Rsa
	enableElement("ipsecLocalRsaUpBtn",false);
	enableElement("ipsecLocalRsaUpFile",false);
	
	// disable cert
	enableElement("ipsecCertiUpBtn",false);
	enableElement("ipsecCertiUpFile",false);
	
	document.body.style.cursor = 'wait';
	upload_running=true;
}

function ipsecUploadTargetOnLoad() {
	if(upload_running) {
		//Function will be called when iframe is loaded
		var ret = frames['uploadTarget'].document.getElementsByTagName("body")[0].innerHTML;
		
		//window.location.reload(true);
		eval(ret);

		if ( typeof(result)=="undefined" || result!="ok" ) {
			alert("The upload operation has failed. Please ensure the connection to the router");
			return;
		}
	}
	document.body.style.cursor = 'default';
	UpdateIpsecCertInfo();

	//reset cert
	resetForm("formIpsecCertiUp");
	enableElement("ipsecCertiUpFile",true);	

	// reset rsa
	resetForm("formIpsecRsaUp");
	enableElement("ipsecRsaUpFile",true);	

	// reset Local rsa
	resetForm("formIpsecLocalRsaUp");
	enableElement("ipsecLocalRsaUpFile",true);	
	
	upload_running=false;
} 

function ipsec_div_display(id, display) {
	if(document.getElementById){
		var el = document.getElementById(id);
		el.style.display = display ? '' : 'none';
	}
}

function ipsecKeyModeEnable(mode) {
	ipsec_div_display("ipsecPresharedKeyDiv",  mode == "psk");
	ipsec_div_display("ipsecRsaKeyDiv",     	mode == "rsa");
	ipsec_div_display("ipsecRemoteRsaDiv", 	mode == "rsa");
	ipsec_div_display("ipsecLocalRsaDiv", 		mode == "rsa");
	ipsec_div_display("ipsecCertsDiv",    	 	mode == "cert");
	ipsec_div_display("ipsecFormCertDiv",    	 mode == "cert");
}
 
function certValidToString(val) {
	if (val == "ok")
		return 'Uploaded';
	if (val == "nofile")
		return 'Not Uploaded';
	if (val == "wrongformat")
		return 'Upload but not valid (e.g. not PKCS#1)';
	return 'Invalid';
}
function ipsec_clear_cert_info() {
	IPSRsaLocalCertValid="nofile";
	IPSRsaRemoteCertValid="nofile";
	IPSRsaKeyValid="nofile";
	curDate="";
	curTime="";
}
function setCertificateText() {
	document.getElementById('keyText').innerHTML = certValidToString(IPSRsaKeyValid);
	document.getElementById('localText').innerHTML = certValidToString(IPSRsaLocalCertValid);
	document.getElementById('remoteText').innerHTML = certValidToString(IPSRsaRemoteCertValid);
	document.getElementById('curDate').innerHTML = curDate;
	document.getElementById('curTime').innerHTML = curTime;
}

function setKeyMode() {   
	var method = document.form.IpSecMethod.value;
	ipsecKeyModeEnable(method);
}

function getCheckedValue(radioObj) {
	if(!radioObj)
		return "";
	var radioLength = radioObj.length;
	if(radioLength == undefined)
		if(radioObj.checked)
			return radioObj.value;
		else
			return "";
	for(var i = 0; i < radioLength; i++) {
		if(radioObj[i].checked) {
			return radioObj[i].value;
		}
	}
	return "";
}

function FinalToDisplay() {   
	var editIndex = document.form.editindex.value;
	var curIndex = document.form.curindex.value;

	if( curIndex >= 0) {
		showedit("edit",true, ipsecTunnelMap[curIndex]);
	}
	else if( editIndex == "") {
		showedit("edit",false, 0);
	}
	else if( editIndex >=0 ) {
		showedit("edit",true, editIndex);
	}
	else
		showedit("edit",false, 0);
}

//ipsec
</script>

<%
if (request['REQUEST_METHOD'] == "POST") {
	tempval = form['rdbCmd'];
	if( tempval != "" )
		set_list( tempval, '-p' );
	// restart openvpn
	set_single('openvpn.0.restart=1');
}
else { /*GET*/
	//form['editindex'] = -1;
}
if(request['QUERY_STRING']!="") {
	form['curindex'] = request['QUERY_STRING'];
}
else {
	form['curindex'] = -1;
}
%>

<form name="form" class="content" method="POST" action="@@request['SCRIPT_NAME']">
<input type="hidden" name="editindex" value="@@form['editindex']">
<input type="hidden" name="curindex" value="@@form['curindex']">
<input type="hidden" name="snatEnable" value="@@form['snatEnable']">
<input type="hidden" name="sdefGwEnable" value="@@form['sdefGwEnable']">
<h3>Internet Settings > VPN</h3>
<div class="line" style="margin: 8px 10% 16px 0;"></div>
<div id="listDiv">
<table width="90%">
	<tr><th>PPTP/OpenVPN List</th></tr>
</table>
<table width="90%">
<tr>
<td width="15%" nowrap bordercolor="#0033cc"><div align="center"><b>Name</b></td>
<td width="5%" nowrap bordercolor="#0033cc"><div align="center"><b>Type</b></td>
<td width="20%" nowrap bordercolor="#0033cc"><div align="center"><b>Remote Address</b></td>
<td width="20%" nowrap bordercolor="#0033cc"><div align="center"><b>User Name</b></td>
<!--td width="20%" nowrap bordercolor="#0033cc"><div align="center"><b>&nbsp;</b></td-->
<td width="4%" nowrap bordercolor="#0033cc"><div align="center"><b>Enable</b></td>
<td width="16%" nowrap bordercolor="#0033cc"><div align="center">&nbsp;</td>
</tr>
<script language="Javascript">
function VPNlist() {
	if (st.length == 0) {
		document.write( "<tr><td colspan='6' align='center'>VPN list empty</td></tr>" );
		return;
	}
	//document.form2.stlength.value = st.length;
	for (var i = 0; i < st.length; i++) {
		if(!(st[i].type=="ipsec.0")) {
			document.write("<tr>"); 
			document.write("<td><div align=\"center\">"+st[i].name+"</div></td>");
			document.write("<td><div align=\"center\">"+st[i].type+"</div></td>");
  
			if((st[i].type=="openvpn.0") && (st[i].vpn_type=="server"))
				document.write("<td ><div align=\"center\">"+st[i].network_addr+"</div></td>");
			else
				document.write("<td ><div align=\"center\">"+st[i].serveraddress+"</div></td>");

			document.write("<td><div align=\"center\">"+st[i].user+"</div></td>");
			document.write("<td><div align=\"center\"><input type=checkbox "+(st[i].enable=='1'?'checked=true':'')+" name='Enable' disabled=true></div></td>");
			document.write("<td><a href=javascript:showedit('edit',"+true+","+i+") >Edit</a>&nbsp;&nbsp;");
			document.write("&nbsp;&nbsp;<a href=javascript:delentry("+i+");>Delete</a></td>");
			document.write("</tr>");
		}
	}
}
VPNlist();
</script>
</table>

<br/>
<br/>
<br/>
<table width="90%">
	<tr><th>IPsec List <a href="/ipseclog.html" name="IPsecLog" style="margin-left:60px" id="IPsecLog" >IPsec Log</a></th></tr>
</table>
<table width="90%">
	<tr>
		<td width="8%" nowrap bordercolor="#0033cc"><div align="center"><b>No.</b></td>
		<td width="12%" nowrap bordercolor="#0033cc"><div align="center"><b>Name</b></td>
		<td width="20%" nowrap bordercolor="#0033cc">
			<div align="center"><b>Remote Network</b>
			<br/>
			<div align="center">IP Address /
			<br/>
			<div align="center">Subnet Mask /
			<br/>
			<div align="center">Gateway
		</td>
		<td width="20%" nowrap bordercolor="#0033cc">
			<div align="center"><b>Local Network</b>
			<br/>
			<div align="center">IP Address /
			<br/>
			<div align="center">Subnet Mask /
			<br/>
			<div align="center">Gateway
		</td>
		<td width="10%" nowrap bordercolor="#0033cc"><div align="center"><b>Type</b></td>
		<!--td width="20%" nowrap bordercolor="#0033cc"><div align="center"><b>&nbsp;</b></td-->
		<td width="10%" nowrap bordercolor="#0033cc"><div align="center"><b>Life Time</b></td>
		<td width="5%" nowrap bordercolor="#0033cc"><div align="center"><b>Enable</b></td>
		<td width="15%" nowrap bordercolor="#0033cc"><div align="center">&nbsp;</td>
	</tr>

<script language="Javascript">
function IPseclist() {   
	var tunnel_num = 0;
	actTunnelNum = 0;
	if (st.length == 0) {
		document.write( "<tr><td colspan='8' align='center'>IPsec list empty</td></tr>" );
		return;
	}
	//document.form2.stlength.value = st.length;
	for (var i = 0; i < st.length; i++)  {
		if(st[i].type=="ipsec.0") {
			tunnel_num ++;
			if(st[i].enable=="1") {
				ipsecTunnelMap[actTunnelNum] = i;
				actTunnelNum ++;
			}
			document.write("<tr>"); 
			document.write("<td><div align=\"center\">"+tunnel_num+"</div></td>");
			document.write("<td><div align=\"center\">"+st[i].name+"</div></td>");
		    	document.write("<td><div align=\"center\">"+st[i].remote_gateway+"</div>");
			document.write("<div align=\"center\">"+st[i].remote_mask+"</div>");
			document.write("<div align=\"center\">"+st[i].remote_lan+"</div></td>");
		    	document.write("<td ><div align=\"center\">"+st[i].local_lan+"</div>");
			document.write("<div align=\"center\">"+st[i].local_mask+"</div></td>");
			document.write("<td><div align=\"center\">"+st[i].enccap_protocol+"</div></td>");
			document.write("<td><div align=\"center\">"+st[i].life_time+"</div></td>");
			document.write("<td><div align=\"center\"><input type=checkbox "+(st[i].enable=='1'?'checked=true':'')+" name='Enable' disabled=true></div></td>");
			document.write("<td><a href=javascript:showedit('edit',"+true+","+i+") >Edit</a>&nbsp;&nbsp;");
			document.write("&nbsp;&nbsp;<a href=javascript:delentry("+i+");>Delete</a></td>");
			document.write("</tr>");
		}
	}
}
IPseclist();
</script>
</table>

<div align="center" style="margin-right:10% ">
<p></p>
<INPUT type="button" value="&nbsp;Add&nbsp;" onClick="javascript:showedit( 'edit', true, st.length )">
</div>
</div>

<div id="editDiv" style="display:none">
<table width="90%">
	<tr><th>VPN Edit</th></tr>
</table>
<table width="90%">
	<tr>
		<td width="38%">Profile Type</td>
		<td>
			<select name="profileType" id="profileType" size=1 onChange="updateFormArrange()" >
				<option value="pptp.0">PPTP</option>
				<option value="gre.0">GRE</option>
				<option value="openvpn.0">OpenVPN</option>
				<option value="ipsec.0">IPSEC</option>
			</select>
		</td>
	</tr>
</table>
<input type="hidden" name="vpnenable" id="vpnenable" value="@@form['vpnenable']"/>
<!--input type="hidden" name="routetopptp" value="@@form['routetopptp']"/-->
<input type="hidden" name="dnstopptp" value="@@form['dnstopptp']"/>
<input type="hidden" name="rdbCmd" value="@@form['rdbCmd']"/>
<table width="90%">
	<tr>
		<td width="38%">
			<div id="enableDiv">Enable VPN</div>
		</td>
		<td>
			<input type=radio name='vpnEnable' onClick="javascript:document.form.vpnenable.value='1';ungreyOutVPNfields(0);setVpnEnable(1)">&nbsp;Enable &nbsp;&nbsp;
			<input type=radio name='vpnEnable' onClick="javascript:document.form.vpnenable.value='0';greyOutVPNfields();setVpnEnable(0)">&nbsp;Disable
		</td>
	</tr>
	<!--td>Set Default Route to PPTP</td>
	<td><input type=radio name='pptpDefaultRouteEnable' onClick="javascript:document.form.routetopptp.value='1'">&nbsp;Enable &nbsp;&nbsp;
	<input type=radio name='pptpDefaultRouteEnable' onClick="javascript:document.form.routetopptp.value='0'">&nbsp;Disable</td>
	</tr-->
	<tr>
		<td>Profile Name</td>
		<td><input type="text" name="newname" id="newname" size=32 maxlength=64 value="@@form['newname']"></td>
	</tr>
	<tr id="serverAddDiv">
		<td><div id="serverAddText">VPN Server Address</div></td>
		<td><input type="text" name="vpnserver" id="vpnserver" size=32 maxlength=64 value="@@form['vpnserver']"></td>
	</tr>
</table>

<table id="pptpDiv" width="90%">
	<tr>
		<td width="38%">Username</td>
		<td><input type=text name='username' size=32 maxlength=64 value="@@form['username']"></td>
	</tr>
	<tr>
		<td>Password</td>
		<td><input type=password name='pass' size=32 maxlength=64 value="@@form['pass']"></td>
	</tr>
	<tr>
		<td>Authentication Type</td>
		<td>
			<select name='authType'  size="1" >
				<option value='any'>Any</option>
				<option value='ms-chap-v2'>MS-CHAP-V2</option>
				<option value='ms-chap'>MS-CHAP</option>
				<option value='chap'>CHAP</option>
				<option value='eap'>EAP</option>
				<option value='pap'>PAP</option>
			</select>
		</td>
	</tr>
	<tr>
		<td>Metric</td>
		<td><input type=text name='metric' size=8 maxLength=5 onkeyup=NumfieldEntry(this); value="@@form['metric']"> &nbsp;(0-65535)</td>
	</tr>
	<tr>
		<td>Use peer DNS</td>
		<td><input type=radio name='pptpDefaultDNSEnable' onClick="javascript:document.form.dnstopptp.value='1'">&nbsp;Enable &nbsp;&nbsp;
		<input type=radio name='pptpDefaultDNSEnable' onClick="javascript:document.form.dnstopptp.value='0'">&nbsp;Disable</td>
	</tr>
	<tr>
		<td width="30%">NAT Masquerading</td>
		<td><input type=radio name='NatEnable' onClick="javascript:document.form.snatEnable.value='1'">&nbsp;Enable&nbsp;&nbsp;&nbsp;
		<input type=radio name='NatEnable' onClick="javascript:document.form.snatEnable.value='0'">&nbsp;Disable</td>
	</tr>
	<tr>
		<td width="30%">Set Default Route to PPtP</td>
		<td><input type=radio name='DefGwEnable' onClick="javascript:document.form.sdefGwEnable.value='1'; document.form.metric.value='10'">&nbsp;Enable&nbsp;&nbsp;&nbsp;
		<input type=radio name='DefGwEnable' onClick="javascript:document.form.sdefGwEnable.value='0'">&nbsp;Disable</td>
	</tr>
</table>

<table id="greDiv" width="90%">
	<tr>
		<td width="38%">TTL</td>
		<td><input type=text name='ttl' size=8 maxLength=5 value="@@form['ttl']" onkeyup=NumfieldEntry(this);> &nbsp;( 0-255 )</td>
	</tr>
</table>

<div id="vpnDiv" name="vpnDiv">
<table id="vpnTypeDiv" width="90%">
	<tr>
		<td id="vpnTypeText" width="38%">OpenVPN Type</td>
		<td>
			<select id="vpnType" name="vpnType" onChange="updateFormArrange()" >
				<option value="server">Server</option>
				<option value="client">Client</option>
				<option value="peer">Peer-To-Peer</option>
			</select>
		</td>
	</tr>
</table>
<input type="hidden" id="vpnServerAuthTypeValue" name="vpnServerAuthTypeValue">
<table id="vpnServerDiv" width="90%">
	<tr>
		<td><div id="vpnServerServerPortText">Server Port</div></td>
		<td>
			<input type="text" id="vpnServerServerPort" name="vpnServerServerPort" size=16 maxlength=32 value="">
			<select name="vpnServerServerPortType" id="vpnServerServerPortType" size=1>
				<option value="UDP">UDP</option>
				<option value="TCP">TCP</option>
			</select>
		</td>
	</tr>

	<tr>
		<td width="38%" id="vpnServerNwAddrText">VPN Network Address</div></td>
		<td><input type="text" id="vpnServerNwAddr" name="vpnServerNwAddr" size=32 maxlength=64 value=""></td>
	</tr>

	<tr>
		<td><div id="vpnNwMaskText">VPN Network Mask</div></td>
		<td><input type="text" id="vpnNwMask" name="vpnNwMask" size=32 maxlength=64 value=""></td>
	</tr>

	<tr id="vpnServerDhDiv">
		<td><div id="vpnServerGenDHText">Diffie-Hellman parameters</div></td>
		<td>
			<p>
				<input id="vpnServerGenDhBtn" type="button" value="Generate DH..." onclick="vpnServerGenDhClick()">
			</p>
			<p>
				<textarea id="vpnDhOutput" cols="60" rows="5" style="background:#F0EFEB; border:2px;overflow:auto; display:none" tabindex="1" name="installMsg" readonly="readonly"></textarea>
			</p>
		</td>
	</tr>

	<tr>
		<td><div id="vpnServerCertiText">Server Certificates</div></td>
		<td>
			<p>
			<input id='vpnServerCertiExpSText' type="text" size=10 maxlength=10 value="Not Before :" class="certi_menu_item" readonly>
			<input id='vpnServerCertiExpS' name="vpnCertiName3" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnServerCertiExpEText' type="text" size=10 maxlength=10 value="Not After :" class="certi_menu_item" readonly>
			<input id='vpnServerCertiExpE' name="vpnCertiName3" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiCountryText4' type="text" size=10 maxlength=10 value="Country :" class="certi_menu_item" readonly>
			<input id='vpnCertiCountry4' type="text" name="vpnCertiCountry4" size=32 maxlength=64>
			</p>

			<p>
			<input id='vpnCertiStateText4' type="text" size=10 maxlength=10 value="State :" class="certi_menu_item" readonly>
			<input id='vpnCertiState4' type="text" name="vpnCertiState4" size=32 maxlength=64>
			</p>

			<p>
			<input id='vpnCertiCityText4' type="text" size=10 maxlength=10 value="City :" class="certi_menu_item" readonly>
			<input id='vpnCertiCity4' type="text" name="vpnCertiCity4" size=32 maxlength=64>
			</p>

			<p>
			<input id='vpnCertiOrgText4' type="text" size=10 maxlength=10 value="Organization :" class="certi_menu_item" readonly>
			<input id='vpnCertiOrg4' type="text" name="vpnCertiOrg4" size=32 maxlength=64>
			</p>

			<p>
			<input id='vpnCertiEmailText4' type="text" size=10 maxlength=10 value="Email :" class="certi_menu_item" readonly>
			<input id='vpnCertiEmail4' type="text" name="vpnCertiEmail4" size=32 maxlength=64>
			</p>

			<input id="vpnServerGenCertiBtn" type="button" value="Generate CA certificate..." onclick="vpnServerGenCertiBtnClick()">
		</td>
	</tr>

	<tr>
		<td><div id="vpnServerAuthTypeText">Authentication Type</div></td>
		<td>
			<p></p>
			<p>
				<input type="radio" onclick="setVpnServerAuthType(0)" name="vpnServerAuthType" id="vpnServerAuthTypeCerti">&nbsp;&nbsp;Certificate
			</p>
			<p></p>
			<p>
				<input type="radio" onclick="setVpnServerAuthType(1)" name="vpnServerAuthType" id="vpnServerAuthTypeUNPW">&nbsp;&nbsp;User Name / Password
			</p>
			<p></p>
		</td>
	</tr>

	<tr id="vpnServerAuthUnpwDiv">
		<td id="vpnServerUnpwText">User Name / Password</td>
		<td>
			<p></p>
			<p>
			<input id="vpnServerAuthUserText" type="text" size=10 maxlength=10 value="User Name :" class="certi_menu_item" readonly>
			<input id='vpnServerAuthUser' name="vpnServerAuthUser" type="text" size=32 maxlength=64 value="Client2">
			</p>

			<p>
			<input id='vpnServerAuthPassText' type="text" size=10 maxlength=10 value="Password :" class="certi_menu_item" readonly>
			<input id='vpnServerAuthPass' name="vpnServerAuthPass" type="password" size=32 maxlength=64 value="Client2">
			</p>

			<p></p>

			<p>
			<input type="button" id="vpnServerDnCertiBtn" size=32 value="Download CA certificate..." onclick="vpnServerDnCertiBtnClick()">
			</p>
   
			<p></p>
			<p></p>

			<p>
			<input id='vpnCertiCaNwAddrText' type="text" size=16 value="Network address:" class="certi_menu_item" readonly>
			<input id='vpnCertiCaNwAddr' type="text" name="vpnCertiCaNwAddr" size=26 maxlength=24 >
			</p>

			<p>
			<input id='vpnCertiCaNwMaskText' type="text" size=16 value="Network Mask:" class="certi_menu_item" readonly>
			<input id='vpnCertiCaNwMask' type="text" name="vpnCertiCaNwMask" size=26 maxlength=24 >
			</p>

			<p>
			<input type="button" id="vpnCertiCaNwSetBtn" size=32 value="Set Network Information" onclick="vpnCertiCaNwSetBtnClick()">
			</p>

		</td>
	</tr>
	<tr id="vpnServerAuthCertiDiv">
		<td><div id="vpnNwMask">Certificate Management</div></td>
		<td>
			<p></p>
			<p>
			<input id="vpnServerCertiSelText" type="text" size=10 maxlength=10 value="Certificate :" class="certi_menu_item" readonly>
			<select id="vpnServerCertiSel" name="vpnServerCertiSel" size=1 onChange="setVpnServerCerti(this.value)" >
			</select>
			</p>

			<p>
			<input id='vpnCertiNameText' type="text" size=10 maxlength=10 value="Name :" class="certi_menu_item" readonly>
			<input id='vpnCertiName' name="vpnCertiName" type="text" size=32 maxlength=64 value="Client2">
			</p>

			<p>
			<input id='vpnCertiCountryText' type="text" size=10 maxlength=10 value="Country :" class="certi_menu_item" readonly>
			<input id='vpnCertiCountry' name="vpnCertiCountry" type="text" size=32 maxlength=64 value="AU">
			</p>

			<p>
			<input id='vpnCertiStateText' type="text" size=10 maxlength=10 value="State :" class="certi_menu_item" readonly>
			<input id='vpnCertiState' name="vpnCertiState" type="text" size=32 maxlength=64 value="NSW">
			</p>

			<p>
			<input id='vpnCertiCityText' type="text" size=10 maxlength=10 value="City :" class="certi_menu_item" readonly>
			<input id='vpnCertiCity' type="text" name="vpnCertiCity" size=32 maxlength=64 value="Sydney">
			</p>

			<p>
			<input id='vpnCertiOrgText' type="text" size=10 maxlength=10 value="Organization :" class="certi_menu_item" readonly>
			<input id='vpnCertiOrg' type="text" name="vpnCertiOrg" size=32 maxlength=64 value="NetComm">
			</p>

			<p>
			<input id='vpnCertiEmailText' type="text" size=10 maxlength=10 value="Email :" class="certi_menu_item" readonly>
			<input id='vpnCertiEmail' type="text" name="vpnCertiEmail" size=32 maxlength=64 value="service@netcommwireless.com">
			</p>

			<p>
			<input id='vpnCertiRevText' type="text" size=10 maxlength=10 value="Revoked:" class="certi_menu_item" readonly>
			<input id='vpnCertiRev' type="text" name="vpnCertiRev" size=32 maxlength=64 class="certi_menu_item" value="" readonly>
			</p>
			<p></p>
			<p>
			<input type="button" id="vpnServerGenClientBtn" size=32 value="Generate" onclick="vpnServerGenClientBtnClick()">
			<input type="button" id="vpnServerDnClientBtn" size=32 value="Download" onclick="vpnServerDnClientBtnClick()">
			<input type="button" id="vpnServerRmClientBtn" size=32 value="Revoke" onclick="vpnServerRmClientBtnClick()">
			</p>

			<p></p>
			<p></p>

			<p>
			<input id='vpnCertiNwAddrText' type="text" size=16 value="Network address:" class="certi_menu_item" readonly>
			<input id='vpnCertiNwAddr' type="text" name="vpnCertiNwAddr" size=26 maxlength=24 >
			</p>

			<p>
			<input id='vpnCertiNwMaskText' type="text" size=16 value="Network Mask:" class="certi_menu_item" readonly>
			<input id='vpnCertiNwMask' type="text" name="vpnCertiNwMask" size=26 maxlength=24 >
			</p>

			<p>
			<input type="button" id="vpnCertiNwSetBtn" size=32 value="Set Network Information" onclick="vpnCertiNwSetBtnClick()">
			</p>
		</td>
	</tr>
</table>
<input type="hidden" id="vpnClientAuthTypeValue" name="vpnClientAuthTypeValue">
<input id='vpnClientCertiSel2' type="hidden">
<table width="90%" id="vpnClientDiv">
	<tr>
		<td width="38%" id="vpnClientServerAddrText">Server IP Address</td>
		<td>
			<input type="text" id="vpnClientServerAddr" name="vpnClientServerAddr" size=32 maxlength=64 value="">
		</td>
	</tr>

	<tr>
		<td><div id="vpnClientServerPortText">Server Port</div></td>
		<td>
			<input type="text" id="vpnClientServerPort" name="vpnClientServerPort" size=16 maxlength=64 value="">
			<select name="vpnClientServerPortType" id="vpnClientServerPortType" size=1>
				<option value="UDP">UDP</option>
				<option value="TCP">TCP</option>
			</select>
		</td>
	</tr>

	<tr>
		<td><div id="vpnClientServerGatewayText">Default Gateway</div></td>
		<td>
			<input type="checkbox" name="vpnClientServerGateway" id="vpnClientServerGateway">&nbsp;&nbsp;Use VPN as default gateway
		</td>
	</tr>

	<tr>
		<td><div id="vpnClientAuthTypeText">Authentication Type</div></td>
		<td>
			<p></p>
			<p>
			<input type="radio" onclick="setVpnClientAuthType(0)" name="vpnClientAuthType" id="vpnClientAuthTypeCerti">&nbsp;&nbsp;Certificate
			</p>
			<p></p>
			<p>
			<input type="radio" onclick="setVpnClientAuthType(1)" name="vpnClientAuthType" id="vpnClientAuthTypeUNPW">&nbsp;&nbsp;User Name / Password
			</p>
			<p></p>
		</td>
	</tr>

	<tr id="vpnClientAuthUnpwDiv">
		<td id="vpnClientUnpwText">User Name / Password</td>
		<td>
			<p></p>
			<p>
			<input id="vpnClientAuthUserText" type="text" size=10 maxlength=10 value="User Name :" class="certi_menu_item" readonly>
			<input id='vpnClientAuthUser' name="vpnClientAuthUser" type="text" size=32 maxlength=64 value="Client2">
			</p>

			<p>
			<input id='vpnClientAuthPassText' type="text" size=10 maxlength=10 value="Password :" class="certi_menu_item" readonly>
			<input id='vpnClientAuthPass' name="vpnClientAuthPass" type="password" size=32 maxlength=64 value="Client2">
			</p>

			<p>
			</p>
		</td>
	</tr>
	<tr id="vpnClientAuthCertiSubjectDiv">
		<td><div id="">Select Certificate</div></td>
		<td>
			<p></p>
			<p>
			<input id='vpnClientCertiSelText' type="text" size=10 maxlength=10 value="Certificate :" class="certi_menu_item" readonly>
			<select id="vpnClientCertiSel" name="vpnClientCertiSel" size=1 onChange="setVpnClientCerti(this.value)" >
			</select>
			<input type="button" size=32 id="vpnClientDelCertiBtn" value="Delete" onclick="vpnClientDelCertiBtnClick()">
			</p>

			<p>
			<input id='vpnCertiExpSText' type="text" size=10 maxlength=10 value="Not Before :" class="certi_menu_item" readonly>
			<input id='vpnCertiExpS' name="vpnCertiName3" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiExpEText' type="text" size=10 maxlength=10 value="Not After :" class="certi_menu_item" readonly>
			<input id='vpnCertiExpE' name="vpnCertiName3" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p></p>
		</td>
	</tr>


	<tr id="vpnClientAuthCertiDiv">
		<td><div id="vpnClientCertiText">Certificate Issuer Informatoin</div></td>
		<td>
			<p>
			<input id='vpnCertiNameText2' type="text" size=10 maxlength=10 value="Name :" class="certi_menu_item" readonly>
			<input id='vpnCertiName2' name="vpnCertiName2" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiCountryText2' type="text" size=10 maxlength=10 value="Country :" class="certi_menu_item" readonly>
			<input id='vpnCertiCountry2' type="text" name="vpnCertiCountry2" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiStateText2' type="text" size=10 maxlength=10 value="State :" class="certi_menu_item" readonly>
			<input id='vpnCertiState2' type="text" name="vpnCertiState2" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiCityText2' type="text" size=10 maxlength=10 value="City :" class="certi_menu_item" readonly>
			<input id='vpnCertiCity2' type="text" name="vpnCertiCity2" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiOrgText2' type="text" size=10 maxlength=10 value="Organization :" class="certi_menu_item" readonly>
			<input id='vpnCertiOrg2' type="text" name="vpnCertiOrg2" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiEmailText2' type="text" size=10 maxlength=10 value="Email :" class="certi_menu_item" readonly>
			<input id='vpnCertiEmail2' type="text" name="vpnCertiEmail2" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p></p>

		</td>
	</tr>

	<tr id="vpnClientAuthCerti3Div">
		<td><div id="vpnClientCertiText">Certificate Subject Information</div></td>
		<td>
			<p>
			<input id='vpnCertiNameText3' type="text" size=10 maxlength=10 value="Name :" class="certi_menu_item" readonly>
			<input id='vpnCertiName3' name="vpnCertiName3" type="text" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiCountryText3' type="text" size=10 maxlength=10 value="Country :" class="certi_menu_item" readonly>
			<input id='vpnCertiCountry3' type="text" name="vpnCertiCountry3" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiStateText3' type="text" size=10 maxlength=10 value="State :" class="certi_menu_item" readonly>
			<input id='vpnCertiState3' type="text" name="vpnCertiState3" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiCityText3' type="text" size=10 maxlength=10 value="City :" class="certi_menu_item" readonly>
			<input id='vpnCertiCity3' type="text" name="vpnCertiCity3" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiOrgText3' type="text" size=10 maxlength=10 value="Organization :" class="certi_menu_item" readonly>
			<input id='vpnCertiOrg3' type="text" name="vpnCertiOrg3" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p>
			<input id='vpnCertiEmailText3' type="text" size=10 maxlength=10 value="Email :" class="certi_menu_item" readonly>
			<input id='vpnCertiEmail3' type="text" name="vpnCertiEmail3" size=32 maxlength=64 class="certi_menu_item" readonly>
			</p>

			<p></p>
		</td>
	</tr>
</table>

<table width="90%" id="vpnPeerDiv">
	<tr>
		<td width="38%"><div id="vpnPeerServerAddrText">Server IP Address</div></td>
		<td>
			<input type="text" id="vpnPeerServerAddr" name="vpnPeerServerAddr" size=32 maxlength=64 value="">
			(server mode if empty)
		</td>
	</tr>
	<tr>
		<td><div id="vpnPeerServerPortText">Server Port</div></td>
		<td>
			<input type="text" id="vpnPeerServerPort" name="vpnPeerServerPort" size=16 maxlength=32 value="">

			<select name="vpnPeerServerPortType" id="vpnPeerServerPortType" size=1>
				<option value="UDP">UDP</option>
				<option value="TCP">TCP</option>
			</select>
		</td>
	</tr>
	<tr>
		<td><div id="vpnLocalAddrText">Local IP Address</div></td>
		<td><input type="text" id="vpnLocalAddr" name="vpnLocalAddr" size=32 maxlength=64 value=""></td>
	</tr>
	<tr>
		<td><div id="vpnRemoteAddrText">Remote IP Address</div></td>
		<td>
			<input type="text" id="vpnRemoteAddr" name="vpnRemoteAddr" size=32 maxlength=64 value="">
		</td>
	</tr>
	<tr>
		<td><div id="vpnRemoteNwText">Remote Network</div></td>
		<td>
			<p></p>
			<p>
			<input id='vpnCertiPeerNwAddrText' type="text" size=16 value="Network address:" class="certi_menu_item" readonly>
			<input id='vpnCertiPeerNwAddr' type="text" name="vpnCertiPeerNwAddr" size=14 maxlength=24 >
			</p>

			<p>
			<input id='vpnCertiPeerNwMaskText' type="text" size=16 value="Network Mask:" class="certi_menu_item" readonly>
			<input id='vpnCertiPeerNwMask' type="text" name="vpnCertiPeerNwMask" size=14 maxlength=24 >
			</p>

			<p></p>
		</td>
	</tr>
	<tr>
		<td id="vpnSecretServerKeyText">Server Secret Key</td>
		<td>
			<p>
			<input type="text" id="vpnSecretServerKeyTimeText" size=10 maxlength=10 value="Update Time:" class="certi_menu_item" readonly>
			<input type="text" id="vpnSecretServerKeyTime" name="vpnSecretServerKeyTime" size=32 maxlength=64 value="May 5 2011 14:18:00" class="certi_menu_item" readonly>
			</p>

			<p>
			<input type="button" size=32 value="Generate" id="vpnSecretServerKeyGenBtn" onclick="vpnSecretServerKeyGenBtnClick()">
			<input type="button" size=32 value="Download..." id="vpnSecretServerKeyDnBtn" onclick="vpnSecretServerKeyDnBtnClick()">
			</p>
		</td>
	</tr>
	<tr>
		<td id="vpnSecretClientKeyText">Client Secret Key</td>
		<td>
			<p>
			<input type="text" id="vpnSecretClientKeyTimeText" size=10 maxlength=10 value="Update Time :" class="certi_menu_item" readonly>
			<input type="text" id="vpnSecretClientKeyTime" name="vpnSecretClientKeyTime" size=32 maxlength=64 value="May 5 2011 14:18:00" class="certi_menu_item" readonly>
			</p>

			<p>
			<input type="button" size=32 value="Delete" id="vpnSecretClientDelBtn" onclick="vpnSecretClientDelBtnClick()">
			</p>
		</td>
	</tr>
</table>
</div>

<table width="90%" id="miscDiv">
	<tr>
		<td width="38%">Verbose logging</td>
		<td><input type=radio name='pppDebug' value=1 >&nbsp;Enable&nbsp;&nbsp;&nbsp;<input type=radio name='pppDebug' value=0 >&nbsp;Disable</td>
	</tr>
	<tr>
		<td>Reconnect Delay</td>
		<td><input type=text name='reconnectDelay' size=8 maxLength=5 value="@@form['reconnectDelay']" onkeyup=NumfieldEntry(this);> &nbsp;( 30-65535 ) secs</td>
	</tr>
	<tr>
		<td>Reconnect Retries</td>
		<td><input type=text name='reconnectRetries' size=8 maxLength=5 value="@@form['reconnectRetries']" onkeyup=NumfieldEntry(this);> &nbsp;( 0-65535, 0=Unlimited )</td>
	</tr>
</table>
<div id="ipsecDiv" name="ipsecDiv">
<input type="hidden" name="RemGateway" ID="Hidden1" value="@@form['RemGateway']">
<input type="hidden" name="RemLan" ID="Hidden2" value="@@form['RemLan']">
<input type="hidden" name="RemLan_2" ID="Hidden2" value="@@form['RemLan']">
<input type="hidden" name="RemLan_3" ID="Hidden2" value="@@form['RemLan']">
<input type="hidden" name="RemLan_4" ID="Hidden2" value="@@form['RemLan']">
<input type="hidden" name="RemMask" ID="Hidden3" value="@@form['RemMask']">
<input type="hidden" name="LocLan" ID="Hidden4" value="@@form['LocLan']">
<input type="hidden" name="LocMask" ID="Hidden5" value="@@form['LocMask']">

<table width="75%">
	<tr><th>Remote Gateway</th></tr>
</table>

<table width="75%" >
	<tr>
		<td width="38%">Remote IPsec Gateway</td>
		<td><input type="text" id="IPSRemGateway" name="IPSRemGateway" size=32 maxlength=64 value=""></td>
		<td> <input type="button" size=32 value="Road Warrior" id="IPSRoadWarrior" onclick=" ipsecRoadWarrior()"></td>
	</tr>
	<tr >
		<td width="38%">Remote Address/Net to Join</td>
		<td> <script language=javascript>htmlGenIpBlocks("IPSRemLan");</script> &nbsp;</td>
	</tr>
	<tr id="remoteLan2MoreDiv">
		<td width="38%"></td>
		<td><script language=javascript>htmlGenIpBlocks("IPSRemLan_2");</script> &nbsp;</td>
	</tr>
	<tr id="remoteLan3MoreDiv">
		<td width="38%"></td>
		<td><script language=javascript>htmlGenIpBlocks("IPSRemLan_3");</script> &nbsp;</td>
	</tr>
	<tr id="remoteLan4MoreDiv">
		<td width="38%"></td>
		<td><script language=javascript>htmlGenIpBlocks("IPSRemLan_4");</script> &nbsp;</td>
	</tr>
	<tr>
		<td width="38%">Remote Address/Net Mask</td>
		<td><script language=javascript>htmlGenMaskBlocks("IPSRemMask");</script> &nbsp;</td>
	</tr>
</table>

<table width="75%">
	<tr><th>Local LAN</th></tr>
</table>

<table width="75%">
	<tr>
		<td width="38%">Local Address/Net to Join</td>
		<td><script language=javascript>htmlGenIpBlocks("IPSLocLan");</script> &nbsp;</td>
	</tr>
	<tr>
		<td width="38%">Local Address/Net Mask</td>
		<td><script language=javascript>htmlGenMaskBlocks("IPSLocMask");</script> &nbsp;</td>
	</tr>
</table>

<table width="75%">
	<tr><th>Negotiation</th></tr>
</table>

<table width="75%">
	<tr>
		<td id="IPsecEncapText" width="38%">Encap Protocol</td>
		<td>
			<select id="ipsecEncap" name="ipsecEncap" >
				<option value="any">Any</option>
				<option value="esp">ESP</option>
				<option value="ah">AH</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecModeText" width="38%">IKE Mode</td>
		<td>
			<select id="ipsecIKEMode" name="ipsecIKEMode" >
				<option value="any">Any</option>
				<option value="main">Main</option>
				<option value="aggressive">Aggressive</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecPfsText" width="38%">Pfs</td>
		<td>
			<select id="ipsecPfs" name="ipsecPfs" >
				<option value="on">On</option>
				<option value="off">Off</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecIKEEncText" width="38%">IKE Encryption</td>
		<td>
			<select id="ipsecIKEEnc" name="ipsecIKEEnc" >
				<option value="any">Any</option>
				<option value="aes">AES</option>
				<option value="aes128">AES-128</option>
				<option value="aes128">AES-192</option>
				<option value="aes256">AES-256</option>
				<option value="3des">3DES</option>
				<option value="des">DES</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecIKEHashText" width="38%">IKE Hash</td>
		<td>
			<select id="ipsecIKEHash" name="ipsecIKEHash" >
				<option value="any">Any</option>
				<option value="md5">MD5</option>
				<option value="sha1">SHA1</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecEncText" width="38%">IPsec Encryption</td>
		<td>
			<select id="ipsecEnc" name="ipsecEnc" >
				<option value="any">Any</option>
				<option value="aes">AES</option>
				<option value="aes128">AES-128</option>
				<option value="aes128">AES-192</option>
				<option value="aes256">AES-256</option>
				<option value="3des">3DES</option>
				<option value="des">DES</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecHashText" width="38%">IPsec Hash</td>
		<td>
			<select id="ipsecHash" name="ipsecHash" >
				<option value="any">Any</option>
				<option value="md5">MD5</option>
				<option value="sha1">SHA1</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecDHGroupText" width="38%">DH Group</td>
		<td>
			<select id="ipsecDHG" name="ipsecDHG" >
				<option value="any">Any</option>
				<option value="modp768">Group1(768)</option>
				<option value="modp1024">Group2(1024)</option>
				<option value="modp1536">Group5(1536)</option>
				<option value="modp2048">Group14(2048)</option>
				<option value="modp3072">Group15(3072)</option>
				<option value="modp4096">Group16(4096)</option>
				<option value="modp6144">Group17(6144)</option>
				<option value="modp8192">Group18(8192)</option>
			</select>
		</td>
	</tr>
	<tr>
		<td id="IPsecDPDActText" width="38%">DPD Action</td>
		<td>
			<select name=ipsecDpdaction ID="ipsecDpdaction" size=1>
				<option value="none">None</option>
				<option value="clear">Clear</option>
				<option value="hold">Hold</option>
				<option value="restart">Restart</option>
			</select>
			</td>
	</tr>
	<tr>
		<td><div id="DpdTimeDelayText">DPD Keep Alive Time</div></td>
		<td><input type="text" id="DpdTimeDelay" name="DpdTimeDelay" size=32 maxlength=64 value="@@form['DpdTimeDelay']">&nbsp;secs</td>
	</tr>
	<tr>
		<td><div id="DpdTimeoutText">DPD Timeout</div></td>
		<td><input type="text" id="DpdTimeout" name="DpdTimeout" size=32 maxlength=64 value="@@form['DpdTimeout']">&nbsp;secs</td>
	</tr>
	<tr>
		<td><div id="IpsecIkeTimeText">Ike Rekey Time</div></td>
		<td><input type="text" id="IpsecIkeTime" name="IpsecIkeTime" size=32 maxlength=64 value="@@form['IpsecIkeTime']">&nbsp;(0-78400, 0=Unlimited) secs</td>
	</tr>
	<tr>
		<td><div id="IpsecLifeTimeText">SA Life Time</div></td>
		<td><input type="text" id="IpsecLifeTime" name="IpsecLifeTime" size=32 maxlength=64 value="@@form['IpsecLifeTime']">&nbsp;(0-78400, 0=Unlimited) secs</td>
	</tr>
	<tr>
		<td id="KeyModeText" width="38%">Key Mode</td>
		<td>
			<select name=IpSecMethod ID="IpSecMethod" onChange="setKeyMode()" size=1>
				<option value="psk">Pre Shared Key</option>
				<option value="rsa">RSA Keys</option>
				<option value="cert">Certificates</option>
			</select>
		</td>
	</tr>
</table>

<table width="75%" id="ipsecPresharedKeyDiv" >
	<tr align=left>
		<td width="38%">Pre Shared Key</td>
		<td><input type=text name=PskValue size=32></td>
	</tr>
	<tr align=left>
		<td width="38%">Remote Id</td>
		<td><input type=text name=PskRemoteId size=32 maxlength=63>&nbsp;( xy.sample.com or blank)</td>
	</tr>

	<tr align=left>
		<td width="38%">Local Id</td>
		<td><input type=text name=PskLocalId size=32 maxlength=63>&nbsp;( xy.sample.com or blank)</td>
	</tr>
</table>

<table width="75%" id="ipsecRsaKeyDiv">
	<tr align=left>
		<td width="38%">Remote Id</td>
		<td><input type=text name=RsaRemoteId size=32 maxlength=63>&nbsp;( xy.sample.com or blank)</td>
	</tr>
	<tr align=left >
		<td width="38%">Local Id</td>
		<td><input type=text name=RsaLocalId size=32 maxlength=63>&nbsp;( xy.sample.com or blank)</td>
	</tr>
	<tr>
		<td width="38%">Local RSA Key</td>
		<td>
		<p>
			<input type="text" id="ipsecRsaKeyTimeText" size=10 maxlength=10 value="Update Time:" class="certi_menu_item" readonly>
			<input type="text" id="ipsecRsaKeyTime" name="ipsecRsaKeyTime" size=32 maxlength=64 value="Sep 19 2011 14:18:00" class="certi_menu_item" readonly>
		</p>

		<p>
			<input type="button" size=32 value="Generate" id="ipsecSecretKeyGenBtn" onclick="ipsecSecretKeyGenBtnClick()">
			<input type="button" size=32 value="Download..." id="ipsecDnRsaBtn" onclick="ipsecDnRsaBtnClick()">
		</p>
		</td>
	</tr>
</table>

<table width="75%" id="ipsecFormCertDiv">
	<tr align=left>
		<td>Private Key Pass Phrase</td>
		<td ><input type=text name=KeyPassword size=32></td>
	</tr>
	<tr align="left">
	<td width="38%"><font face="Arial, Helvetica, sans-serif" size="2">Key or Certificate<br /><b id='curDate'></b><br /><b id='curTime'></b></font></td>
	<td>
		<table border=0 cellspacing=1 cellpadding=5>
			<tr align="left">
				<td><input type="radio" name="uploadFileType" value="key"> Local Private Key</td>
				<td id='keyText'><b>Not Uploaded</b></td>
			</tr>
			<tr>
				<td><input type="radio" name="uploadFileType" value="local"/> Local Public Certificate</td>
				<td id='localText'><b>Not Uploaded</b></td>
			</tr>
			<tr>
				<td><input type="radio" name="uploadFileType" value="remote"/> Remote Public Certificate</td>
				<td id='remoteText'><b>Not Uploaded</b></td>
			</tr>
			<tr>
				<td><input type="radio" name="uploadFileType" value="ca"/> CA Certificate</td>
			</tr>
			<tr>
				<td><input type="radio" name="uploadFileType" value="crls"/> CRL Certificate</td>
			</tr>
		</table></td>
	</tr>
</table>
</div>
</div>
</form>

<div id="vpn2Div" name="vpn2Div">
	<!--- upload form for client --->
	<div id="vpnCaUpDiv">
		<form id="formVpnCaUp" name="formVpnCaUp" class="content" method="POST" action="/cgi-bin/vpn_action.cgi?action=upload" encType="multipart/form-data">
		<table width="90%">
			<tr>
				<td width="38%">CA Upload</td>
				<td>
					<input type="hidden" id="vpnCaUpSubaction" name="subaction" value="upca"/>
					<input type="hidden" id="vpnCaUpParam" name="param" value=""/>
					
					<input type="text" id="vpnCaUpFileText" size=10 maxlength=10 value="Select File:" class="certi_menu_item" readonly>
					<input type="file" height="40" size="30" id="vpnCaUpFile" name="vpnCaUpFile" onchange="vpnCaUpFileChange()">
					<p></p>

					<p>
					<input type="text" id="vpnCaUpNameText" size=10 maxlength=10 value="CA Name:" class="certi_menu_item" readonly>
					<input type="text" id="vpnCaUpName" height="40" size=30 maxlength=64 onkeyup="vpnCaUpFileChange()">
					<input type="button" size=32 value="Upload" id="vpnCaUpBtn" onclick="vpnCaUpBtnClick()" disabled=true>
					</p>
				</td>
			</tr>
		</table>	
		</form>
	</div>

	<div id="vpnCertiUpDiv">
		<form id="formVpnCertiUp" name="formVpnCertiUp" class="content" method="POST" action="/cgi-bin/vpn_action.cgi?action=upload" encType="multipart/form-data">
		<table width="90%">
			<tr>
				<td width="38%">Certificate Upload</td>
				<td>
					<input type="hidden" id="vpnCertiUpSubaction" name="subaction" value="upclient"/>
					<input type="hidden" id="vpnCertiUpParam" name="param" value=""/>
					<input type="file" height="40" size="35" id="vpnCertiUpFile" name="vpnCertiUpFile" onchange="vpnCertiUpFileChange()">
					<input type="button" size=32 value="Upload" id="vpnCertiUpBtn" onclick="uploadTargetStart(formVpnCertiUp)" disabled=true>
				</td>
			</tr>
		</table>	
		</form>
	</div>

	<!--- upload form for peer --->
	<div id="vpnSecretUpDiv">
		<form id="formVpnSecretUp" name="formVpnSecretUp" class="content" method="POST" action="/cgi-bin/vpn_action.cgi?action=upload" encType="multipart/form-data">
		<table width="90%">
			<tr>
				<td width="38%">Client Secret Key Upload</td>
				<td>
					<input type="hidden" id="vpnSecretUpSubaction" name="subaction" value="upsecret"/>
					<input type="hidden" id="vpnSecretUpParam" name="param" value=""/>
					<input type="file" height="40" size="35" id="vpnSecretUpFile" name="vpnSecretUpFile" onchange="vpnSecretUpFileChange()">
					<input type="button" size=32 value="Upload" id="vpnSecretUpBtn" onclick="uploadTargetStart(formVpnSecretUp)" disabled=true>
				</td>
			</tr>
		</table>	
		</form>
	</div>
</div>	
<div id="editDiv1">
<div id="ipsecLocalRsaDiv" name="ipsecLocalRsaDiv">
	<form id="formIpsecLocalRsaUp" name="formIpsecLocalRsaUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
	<table width="90%">
		<tr>
			<td width="38%">Local Rsa Key Upload</td>
			<td>
				<input type="hidden" id="ipsecLocalRsaUpSubaction" name="subaction" value="upIpsecLocalRsa"/>
				<input type="hidden" id="ipsecLocalRsaUpParam" name="param" value=""/>
				<input type="file" height="40" size="35" id="ipsecLocalRsaUpFile" name="ipsecLocalRsaUpFile" onchange="ipsecLocalRsaUpFileChange()">
				<input type="button" size=32 value="Upload" id="ipsecLocalRsaUpBtn" onclick="ipsecUploadTargetStart(formIpsecLocalRsaUp)" disabled=true>
			</td>
		</tr>
	</table>	
	</form>
</div>

<div id="ipsecRemoteRsaDiv" name="ipsecRemoteRsaDiv">
	<form id="formIpsecRsaUp" name="formIpsecRsaUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
	<table width="90%">
		<tr>
			<td width="38%">Remote Rsa Key Upload</td>
			<td>
				<input type="hidden" id="ipsecRsaUpSubaction" name="subaction" value="upIpsecRsa"/>
				<input type="hidden" id="ipsecRsaUpParam" name="param" value=""/>
				<input type="file" height="40" size="35" id="ipsecRsaUpFile" name="ipsecRsaUpFile" onchange="ipsecRsaUpFileChange()">
				<input type="button" size=32 value="Upload" id="ipsecRsaUpBtn" onclick="ipsecUploadTargetStart(formIpsecRsaUp)" disabled=true>
			</td>
		</tr>
	</table>	
	</form>
</div>

<div id="ipsecCertsDiv" name="ipsecCertsDiv">
	<form id="formIpsecCertiUp" name="formIpsecCertiUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
	<table width="90%">
		<tr>
			<td width="38%">Ipsec Certificate Upload</td>
			<td>
				<input type="hidden" id="ipsecCertiUpSubaction" name="subaction" value="upIpsecCert"/>
				<input type="hidden" id="ipsecCertiUpParam" name="param" value=""/>
				<input type="file" height="40" size="35" id="ipsecCertiUpFile" name="ipsecCertiUpFile" onchange="ipsecCertiUpFileChange()">
				<input type="button" size=32 value="Upload" id="ipsecCertiUpBtn" onclick="ipsecUploadTargetStart(formIpsecCertiUp)" disabled=true>
			</td>
		</tr>
	</table>	
	</form>
</div>
</div>
<div class="line" style="margin: 20px 10% 16px 0;"></div>	
	<div align="center" id=saveDiv style="margin-right:10% ">
		<p></p>
		<INPUT TYPE="button" VALUE="Save" id="submitBtn" onClick="javascript:submitForm()">&nbsp;&nbsp;
		<INPUT TYPE="button" VALUE="&nbsp;Exit&nbsp;" onClick="javascript:exitHandler()">
	</div>
</div>

<!--- hidden download form --->
<form id="formVpnActionDn" name="formVpnActionDn" method="GET" action="/cgi-bin/vpn_action.cgi" encType="multipart/form-data" style='display:none'>
<input type="hidden" id="dn_action" name="action" value=""/>
<input type="hidden" id="dn_param" name="param" value=""/>
</form>

<!--- hidden download form for IPSEC--->
<form id="formIpsecActionDn" name="formIpsecActionDn" method="GET" action="/cgi-bin/ipsec_action.cgi" encType="multipart/form-data" style='display:none'>
<input type="hidden" id="ipsec_dn_action" name="action" value=""/>
<input type="hidden" id="ipsec_dn_param" name="param" value=""/>
</form>

<div id="footer">User Name:&nbsp;&nbsp;&nbsp;<%write(session["user"]);%>
<div style="text-align:right" id="copyRight"></div></div>

<!--- hidden iframe for upload --->
<iframe id="uploadTarget" name="uploadTarget" src="" style="width:0;height:0;border:0px solid #fff;" onload="javascript:uploadTargetOnLoad();"></iframe>

<script>
FinalToDisplay();
</script>

<script type="text/javascript">
setCopyRight();
</script>
</body>
</html>
